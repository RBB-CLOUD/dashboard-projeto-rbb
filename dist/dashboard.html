<!DOCTYPE html>
<html lang="en">
<head>
  <script src="/config.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>RBB - Control Panel</title>
  <script>
    // ğŸ”¥ LIMPA CACHE AUTOMÃTICO
    const VERSAO_DASHBOARD = '2.0.1';
    const versaoAtual = localStorage.getItem('rbb_versao');
    
    if (versaoAtual !== VERSAO_DASHBOARD) {
      console.log('ğŸ”„ Nova versÃ£o detectada! Limpando cache...');
      
      // Limpa localStorage (exceto credenciais)
      const senha = localStorage.getItem('rbb_autenticado');
      localStorage.clear();
      if (senha) localStorage.setItem('rbb_autenticado', senha);
      localStorage.setItem('rbb_versao', VERSAO_DASHBOARD);
      
      // Limpa service workers
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
          registrations.forEach(reg => reg.unregister());
        });
      }
      
      // Limpa cache do navegador
      if ('caches' in window) {
        caches.keys().then(names => {
          names.forEach(name => caches.delete(name));
        });
      }
      
      console.log('âœ… Cache limpo! VersÃ£o: ' + VERSAO_DASHBOARD);
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    #login-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      z-index: 9999;
    }

    .login-box {
      background: white;
      border-radius: 16px;
      padding: 40px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .login-box h2 {
      color: #667eea;
      margin-bottom: 10px;
      text-align: center;
      font-size: 28px;
    }

    .login-box p {
      color: #666;
      margin-bottom: 30px;
      text-align: center;
    }

    .login-box input {
      width: 100%;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      margin-bottom: 20px;
      transition: border-color 0.3s;
    }

    .login-box input:focus {
      outline: none;
      border-color: #667eea;
    }

    .login-box button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .login-box button:hover {
      transform: translateY(-2px);
    }

    .hidden { display: none !important; }

    header {
      background: white;
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      color: #667eea;
      font-size: 32px;
      margin: 0;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      background: #f0f4ff;
      border-radius: 8px;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #10b981;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    }

    .card h3 {
      color: #888;
      margin-bottom: 10px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .card .value {
      font-size: 42px;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .section {
      background: white;
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .section h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 22px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button.secondary {
      background: #6b7280;
    }

    button.secondary:hover {
      box-shadow: 0 4px 12px rgba(107, 114, 128, 0.4);
    }

    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background: #f8fafc;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      color: #667eea;
      border-bottom: 2px solid #e2e8f0;
    }

    td {
      padding: 15px;
      border-bottom: 1px solid #e2e8f0;
      color: #333;
    }

    tr:hover {
      background: #f8fafc;
    }

    .status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
    }

    .status.fila {
      background: #fef3c7;
      color: #92400e;
    }

    .status.processando {
      background: #dbeafe;
      color: #1e40af;
    }

    .status.concluido {
      background: #d1fae5;
      color: #065f46;
    }

    .status.erro {
      background: #fee2e2;
      color: #991b1b;
    }

    .log-entry {
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
      background: #f8fafc;
    }

    .log-entry.error {
      border-left-color: #ef4444;
      background: #fef2f2;
    }

    .log-entry.warn {
      border-left-color: #f59e0b;
      background: #fffbeb;
    }

    .log-entry strong {
      color: #667eea;
    }

    .log-entry small {
      color: #888;
      font-size: 12px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #888;
    }

    .spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.9; transform: scale(1.02); }
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #888;
    }

    .empty-state h3 {
      font-size: 24px;
      margin-bottom: 10px;
      color: #667eea;
    }

    .logout-btn {
      background: #ef4444 !important;
      padding: 10px 20px;
    }

    .logout-btn:hover {
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4) !important;
    }

    /* Chat Sidebar Replit Style */
    #chat-sidebar {
      position: fixed;
      left: -400px;
      top: 0;
      bottom: 0;
      width: 400px;
      background: #1e293b;
      box-shadow: 4px 0 20px rgba(0,0,0,0.3);
      z-index: 10000;
      transition: left 0.3s ease;
      display: flex;
      flex-direction: column;
    }

    #chat-sidebar.open {
      left: 0;
    }

    #chat-toggle-btn {
      position: fixed;
      left: 20px;
      bottom: 20px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
      z-index: 9999;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #chat-toggle-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 30px rgba(102, 126, 234, 0.6);
    }

    #chat-toggle-btn.open {
      left: 420px;
    }

    .chat-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-header h2 {
      font-size: 18px;
      margin: 0;
    }

    .chat-close-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .chat-close-btn:hover {
      background: rgba(255,255,255,0.3);
    }

    .chat-messages-container {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 20px;
      background: #0f172a;
      scroll-behavior: smooth;
    }

    .chat-messages-container::-webkit-scrollbar {
      width: 8px;
    }

    .chat-messages-container::-webkit-scrollbar-track {
      background: #0f172a;
    }

    .chat-messages-container::-webkit-scrollbar-thumb {
      background: #475569;
      border-radius: 4px;
    }

    .chat-messages-container::-webkit-scrollbar-thumb:hover {
      background: #667eea;
    }

    .chat-message {
      margin-bottom: 15px;
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .chat-message.user {
      text-align: right;
    }

    .chat-message.ai {
      text-align: left;
    }

    .chat-bubble {
      display: inline-block;
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 12px;
      word-wrap: break-word;
    }

    .chat-message.user .chat-bubble {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .chat-message.ai .chat-bubble {
      background: #1e293b;
      color: #e2e8f0;
      border: 1px solid #334155;
    }

    .chat-avatar {
      font-size: 12px;
      color: #94a3b8;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .chat-time {
      font-size: 10px;
      color: #64748b;
      margin-top: 5px;
    }

    .chat-input-container {
      padding: 20px;
      background: #1e293b;
      border-top: 1px solid #334155;
    }

    .chat-input-wrapper {
      display: flex;
      gap: 10px;
    }

    .chat-input {
      flex: 1;
      background: #1e293b;
      border: 2px solid #334155;
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      font-size: 15px;
      font-family: inherit;
    }

    .chat-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .chat-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .chat-send-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.2s;
    }

    .chat-send-btn:hover {
      transform: scale(1.05);
    }

    .chat-send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    @media (max-width: 768px) {
      #chat-sidebar {
        width: 100%;
        left: -100%;
      }
      
      #chat-toggle-btn.open {
        left: calc(100% - 80px);
      }
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="login-screen">
    <div class="login-box">
      <h2>ğŸ” RBB Control Panel</h2>
      <p>Enter password to access</p>
      <input type="password" id="password-input" placeholder="Access password" data-testid="input-password">
      <button onclick="login()" data-testid="button-login">Enter</button>
    </div>
  </div>

  <!-- Chat Sidebar (Estilo Replit) -->
  <div id="chat-sidebar">
    <div class="chat-header">
      <h2>ğŸ’¬ AI Chat - APENAS CONVERSA</h2>
      <button class="chat-close-btn" onclick="toggleChat()" data-testid="button-close-chat">Ã—</button>
    </div>
    
    <div class="chat-messages-container" id="sidebar-chat-messages">
      <div class="chat-message ai">
        <div class="chat-avatar">ğŸ¤– Arquiteto IA (GPT-4)</div>
        <div class="chat-bubble">
          <strong style="color: #f59e0b; font-size: 15px;">âš ï¸ MODO CONVERSAÃ‡ÃƒO APENAS</strong><br><br>
          OlÃ¡! Sou o Arquiteto IA para te ajudar com:<br><br>
          â€¢ Explicar cÃ³digo e soluÃ§Ãµes<br>
          â€¢ Dar dicas de desenvolvimento<br>
          â€¢ Responder dÃºvidas tÃ©cnicas<br>
          â€¢ Sugerir abordagens<br><br>
          <div style="background: #dcfce7; padding: 10px; border-radius: 6px; margin: 10px 0;">
            <strong style="color: #10b981;">âœ… EU APENAS CONVERSO</strong>
          </div>
          <div style="background: #fee2e2; padding: 10px; border-radius: 6px;">
            <strong style="color: #ef4444;">âŒ NÃƒO EXECUTO TAREFAS</strong>
          </div>
          <br>
          Para executar aÃ§Ãµes, use os botÃµes do dashboard!
        </div>
        <div class="chat-time">Sistema iniciado</div>
      </div>
    </div>
    
    <!-- Preview da imagem anexada no sidebar -->
    <div id="sidebar-image-preview" style="display: none; background: #f3f4f6; padding: 10px; margin: 10px; border-radius: 8px;">
      <div style="display: flex; align-items: center; gap: 10px;">
        <img id="sidebar-preview-img" style="max-width: 80px; max-height: 80px; border-radius: 4px;">
        <span id="sidebar-preview-name" style="color: #333; font-size: 12px; flex: 1;"></span>
        <button onclick="removerImagemSidebar()" style="background: #ef4444; color: white; padding: 5px 10px; border-radius: 4px; border: none; cursor: pointer; font-size: 12px;">âŒ</button>
      </div>
    </div>

    <div class="chat-input-container">
      <div class="chat-input-wrapper">
        <input type="file" id="sidebar-file-input" accept="image/*" style="display: none;" onchange="handleImageUploadSidebar(event)">
        <button onclick="document.getElementById('sidebar-file-input').click()" style="background: #667eea; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; margin-right: 5px; font-size: 16px;">ğŸ“</button>
        <input 
          type="text" 
          id="sidebar-chat-input" 
          class="chat-input" 
          placeholder="Digite sua mensagem (pode anexar imagens ğŸ“)..."
          onkeypress="if(event.key === 'Enter') enviarMensagemSidebar()"
          data-testid="input-sidebar-chat">
        <button 
          class="chat-send-btn" 
          onclick="enviarMensagemSidebar()"
          id="sidebar-send-btn"
          data-testid="button-send-sidebar">
          ğŸš€
        </button>
      </div>
    </div>
  </div>

  <!-- Chat Toggle Button -->
  <button id="chat-toggle-btn" onclick="toggleChat()" data-testid="button-toggle-chat">
    ğŸ’¬
  </button>

  <!-- Dashboard -->
  <div id="dashboard" class="container hidden">
    <header>
      <h1>ğŸ™ï¸ Radio Business Brasil</h1>
      <div style="display: flex; gap: 15px; align-items: center;">
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span style="font-weight: 600; color: #667eea;">System Online</span>
        </div>
        <button onclick="mostrarDeploy()" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'" data-testid="button-deploy">ğŸš€ Deploy</button>
        <a href="/help.html" target="_blank" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; text-decoration: none; font-weight: bold; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'" data-testid="button-help">ğŸ“š Ajuda</a>
        <button class="logout-btn" onclick="logout()" data-testid="button-logout">Logout</button>
      </div>
    </header>

    <!-- Stats Cards -->
    <div class="cards">
      <div class="card">
        <h3>Queue</h3>
        <div class="value" id="count-fila">-</div>
      </div>
      <div class="card">
        <h3>Processing</h3>
        <div class="value" id="count-processando">-</div>
      </div>
      <div class="card">
        <h3>Completed Today</h3>
        <div class="value" id="count-concluido">-</div>
      </div>
      <div class="card">
        <h3>Errors</h3>
        <div class="value" id="count-erro">-</div>
      </div>
    </div>

    <!-- AI Chat -->
    <div class="section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <h2 style="color: white;">ğŸ’¬ Chat with AI Architect - EXECUÃ‡ÃƒO</h2>
      
      <!-- Ãrea de Progresso em Tempo Real -->
      <div id="progresso-arquiteto" style="display: none; background: linear-gradient(135deg, #f59e0b 0%, #ea580c 100%); border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); animation: pulse 2s infinite;">
        <div style="text-align: center;">
          <strong style="color: white; font-size: 18px; display: block; margin-bottom: 10px;">ğŸ—ï¸ ARQUITETO IA TRABALHANDO</strong>
          <p id="progresso-texto" style="color: rgba(255,255,255,0.95); font-size: 15px; margin: 0; font-weight: 600;">Iniciando...</p>
          <div style="background: rgba(255,255,255,0.2); border-radius: 8px; height: 6px; margin-top: 15px; overflow: hidden;">
            <div id="progresso-barra" style="background: white; height: 100%; width: 0%; transition: width 0.3s ease;"></div>
          </div>
        </div>
      </div>

      <div id="chat-container" style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; max-height: 400px; overflow-y: auto;">
        <div id="chat-messages"></div>
      </div>
      
      <!-- Preview da imagem anexada -->
      <div id="image-preview" style="display: none; background: white; border-radius: 8px; padding: 10px; margin-bottom: 10px;">
        <div style="display: flex; align-items: center; gap: 10px;">
          <img id="preview-img" style="max-width: 100px; max-height: 100px; border-radius: 4px;">
          <span id="preview-name" style="color: #333; font-size: 13px;"></span>
          <button onclick="removerImagem()" style="margin-left: auto; background: #ef4444; color: white; padding: 5px 10px; border-radius: 4px; border: none; cursor: pointer;">âŒ Remover</button>
        </div>
      </div>

      <div style="display: flex; gap: 10px; align-items: center;">
        <input type="file" id="chat-file-input" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
        <button onclick="document.getElementById('chat-file-input').click()" style="background: #1e293b; color: white; font-weight: bold; padding: 15px 20px; border-radius: 8px; border: 2px solid #334155; cursor: pointer; font-size: 18px;" data-testid="button-attach-file">ğŸ“</button>
        <input type="text" id="chat-input" placeholder="Digite sua tarefa para execuÃ§Ã£o... (pode anexar imagens ğŸ“)" style="flex: 1; background: #1e293b; border: 2px solid #334155; color: white; padding: 15px 20px; border-radius: 8px; font-size: 15px;" data-testid="input-chat">
        <button id="btn-enviar" onclick="enviarMensagem()" style="background: #10b981; color: white; font-weight: bold; padding: 15px 24px; border-radius: 8px; border: none; cursor: pointer; font-size: 15px; pointer-events: auto; position: relative; z-index: 100;" data-testid="button-send-message">Enviar ğŸš€</button>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="section">
      <h2>âš¡ Quick Actions</h2>
      <div class="btn-group">
        <button onclick="testarCodeReview()" style="background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);" data-testid="button-code-review">ğŸ” Code Review (Claude)</button>
        <button onclick="testarEmail()" data-testid="button-test-email">ğŸ“§ Test Email</button>
        <button onclick="testarPagina()" data-testid="button-test-page">ğŸ“„ Test Page</button>
        <button onclick="testarPython()" data-testid="button-test-python">ğŸ Run Python</button>
        <button onclick="testarNode()" data-testid="button-test-node">ğŸ“¦ Run Node.js</button>
        <button onclick="testarJava()" data-testid="button-test-java">â˜• Run Java</button>
        <button onclick="refreshAll()" class="secondary" data-testid="button-refresh">ğŸ”„ Refresh All</button>
      </div>
    </div>

    <!-- ConfiguraÃ§Ã£o Modelo GPT -->
    <div class="section" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
      <h2 style="color: white;">âš™ï¸ ConfiguraÃ§Ã£o do Modelo GPT</h2>
      <div style="background: white; border-radius: 12px; padding: 20px;">
        <div style="margin-bottom: 15px;">
          <p style="color: #666; margin-bottom: 20px;">
            <strong>Modelo Atual:</strong> <span id="modelo-atual" style="color: #f59e0b; font-weight: bold;">Carregando...</span>
          </p>
          
          <label style="display: block; margin-bottom: 8px; color: #333; font-weight: bold;">ğŸ¤– Selecione o Modelo GPT:</label>
          <select id="modelo-gpt-select" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 15px; color: #333;" data-testid="select-gpt-model">
            <option value="gpt-4o-mini">gpt-4o-mini (BARATO - $0.15/1M tokens) â­ RECOMENDADO</option>
            <option value="gpt-3.5-turbo">gpt-3.5-turbo (MUITO BARATO - $0.50/1M tokens)</option>
            <option value="gpt-4o">gpt-4o (MÃ‰DIO - $2.50/1M tokens)</option>
            <option value="gpt-4-turbo">gpt-4-turbo (CARO - $10/1M tokens)</option>
          </select>
          <small style="color: #666; display: block; margin-top: 8px;">ğŸ’¡ Troque quando quiser economizar ou precisar de mais poder</small>
        </div>

        <div style="display: flex; gap: 10px;">
          <button onclick="mudarModeloGPT()" style="flex: 1; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 15px; border-radius: 8px; font-weight: bold; border: none; cursor: pointer;" data-testid="button-change-model">
            âœ… Aplicar MudanÃ§a
          </button>
          <button onclick="verModeloAtual()" style="background: #6b7280; color: white; padding: 15px 20px; border-radius: 8px; font-weight: bold; border: none; cursor: pointer;" data-testid="button-view-current-model">
            ğŸ“Š Ver Atual
          </button>
        </div>

        <div id="modelo-status" style="margin-top: 15px; padding: 12px; background: #f0f9ff; border-left: 4px solid #0284c7; border-radius: 4px; display: none;">
          <p style="color: #0284c7; margin: 0; font-weight: bold;"></p>
        </div>
      </div>
    </div>

    <!-- Recent Errors -->
    <div class="section" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
      <h2 style="color: white;">ğŸš¨ Recent Errors</h2>
      <div id="erros-lista"></div>
    </div>

    <!-- Shell Terminal -->
    <div class="section" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);">
      <h2 style="color: white;">ğŸ’» Shell Terminal (Tests)</h2>
      <div style="background: #1e293b; border-radius: 12px; padding: 20px; border: 2px solid #334155;">
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-weight: bold; font-family: monospace;">$ command</label>
          <input type="text" id="shell-command" placeholder="Ex: ls -la, cat arquivo.txt, npm --version" 
                 style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 8px; color: #22d3ee; font-family: 'Courier New', monospace; font-size: 14px;" 
                 data-testid="input-shell-command"
                 onkeypress="if(event.key === 'Enter') executarShell()">
        </div>
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
          <button onclick="executarShell()" 
                  style="flex: 1; background: #22d3ee; color: #0f172a; padding: 12px; border-radius: 8px; font-weight: bold; font-family: monospace;" 
                  data-testid="button-run-shell">
            â–¶ Run
          </button>
          <button onclick="limparShell()" 
                  style="background: #334155; color: white; padding: 12px 20px; border-radius: 8px; font-weight: bold;" 
                  data-testid="button-clear-shell">
            ğŸ—‘ï¸ Clear
          </button>
        </div>
        <div id="shell-output" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 15px; min-height: 200px; max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 13px; color: #94a3b8; white-space: pre-wrap;"></div>
      </div>
    </div>

    <!-- GitHub Push & Pull -->
    <div class="section" style="background: linear-gradient(135deg, #24292e 0%, #1a1e22 100%);">
      <h2 style="color: white;">ğŸ”„ GitHub - Push & Pull</h2>
      
      <!-- PULL RÃPIDO -->
      <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);">
        <div style="display: flex; align-items: center; gap: 15px;">
          <div style="flex: 1;">
            <input type="text" id="github-pull-quick-repo" placeholder="Ex: seu-usuario/seu-repositorio" style="width: 100%; padding: 12px; border: 2px solid rgba(255,255,255,0.3); border-radius: 8px; background: rgba(255,255,255,0.15); color: white; font-weight: bold; font-size: 14px; backdrop-filter: blur(10px);" data-testid="input-github-pull-quick" onkeypress="if(event.key === 'Enter') pullRapidoGitHub()">
          </div>
          <button onclick="pullRapidoGitHub()" style="background: white; color: #2563eb; padding: 12px 30px; border-radius: 8px; font-weight: bold; font-size: 16px; white-space: nowrap; box-shadow: 0 2px 10px rgba(0,0,0,0.2);" data-testid="button-pull-quick">
            ğŸ“¥ PULL RÃ¡pido
          </button>
        </div>
        <small style="color: rgba(255,255,255,0.9); display: block; margin-top: 10px;">ğŸ’¡ Digite o repositÃ³rio e pressione Enter ou clique no botÃ£o</small>
      </div>
      
      <!-- PUSH -->
      <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
        <h3 style="margin: 0 0 15px 0; color: #24292e;">ğŸš€ Push to GitHub (Upload)</h3>
        <div style="display: grid; gap: 15px;">
          <div>
            <label style="display: block; margin-bottom: 5px; color: #333; font-weight: bold;">ğŸ“ Pasta Local</label>
            <input type="text" id="github-pasta" placeholder="Ex: paginas_geradas/landing-page" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; color: #333;" data-testid="input-github-folder">
            <small style="color: #666;">Caminho da pasta que vocÃª quer enviar</small>
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; color: #333; font-weight: bold;">ğŸ“¦ RepositÃ³rio GitHub</label>
            <input type="text" id="github-repo" placeholder="Ex: seu-usuario/seu-repositorio" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; color: #333;" data-testid="input-github-repo">
            <small style="color: #666;">Formato: usuario/repositorio</small>
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; color: #333; font-weight: bold;">ğŸŒ¿ Branch</label>
            <input type="text" id="github-branch" value="main" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; color: #333;" data-testid="input-github-branch">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; color: #333; font-weight: bold;">ğŸ“ Mensagem do Commit</label>
            <input type="text" id="github-mensagem" placeholder="Ex: Adiciona nova landing page" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; color: #333;" data-testid="input-github-message">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; color: #333; font-weight: bold;">ğŸ“‚ Pasta Destino (opcional)</label>
            <input type="text" id="github-destino" placeholder="Ex: website (deixe vazio para usar o nome da pasta local)" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; color: #333;" data-testid="input-github-destination">
            <small style="color: #666;">Onde a pasta serÃ¡ colocada no repositÃ³rio</small>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button onclick="pushDiretoGitHub()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 15px; border-radius: 8px; font-weight: bold; font-size: 16px;" data-testid="button-push-direct">
              âš¡ Push Direto (RÃ¡pido)
            </button>
            <button onclick="enviarParaGitHub()" style="background: linear-gradient(135deg, #24292e 0%, #1a1e22 100%); color: white; padding: 15px; border-radius: 8px; font-weight: bold; font-size: 16px;" data-testid="button-push-github">
              ğŸ¤– Push via Agente
            </button>
          </div>
        </div>
      </div>

      <!-- PULL -->
      <div style="background: white; border-radius: 12px; padding: 20px;">
        <h3 style="margin: 0 0 15px 0; color: #24292e;">ğŸ“¥ Pull from GitHub (Download)</h3>
        <div style="display: grid; gap: 15px;">
          <div>
            <label style="display: block; margin-bottom: 5px; color: #333; font-weight: bold;">ğŸ“¦ RepositÃ³rio GitHub</label>
            <input type="text" id="github-pull-repo" placeholder="Ex: seu-usuario/seu-repositorio" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; color: #333;" data-testid="input-github-pull-repo">
            <small style="color: #666;">Formato: usuario/repositorio</small>
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; color: #333; font-weight: bold;">ğŸŒ¿ Branch</label>
            <input type="text" id="github-pull-branch" value="main" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; color: #333;" data-testid="input-github-pull-branch">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; color: #333; font-weight: bold;">ğŸ“‚ Pasta EspecÃ­fica (opcional)</label>
            <input type="text" id="github-pull-pasta" placeholder="Ex: src/components (deixe vazio para baixar tudo)" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; color: #333;" data-testid="input-github-pull-folder">
            <small style="color: #666;">Baixa apenas uma pasta especÃ­fica do repositÃ³rio</small>
          </div>
          <button onclick="pullDiretoGitHub()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 15px; border-radius: 8px; font-weight: bold; font-size: 16px; width: 100%;" data-testid="button-pull-direct">
            ğŸ“¥ Pull do GitHub (Download)
          </button>
          <div id="pull-result" style="display: none; background: #f0fdf4; border: 2px solid #10b981; border-radius: 8px; padding: 15px; margin-top: 10px;">
            <div id="pull-result-content"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Google Workspace Integrations -->
    <div class="section" style="background: linear-gradient(135deg, rgba(66, 133, 244, 0.1) 0%, rgba(219, 68, 55, 0.1) 100%); border-radius: 16px; padding: 25px; box-shadow: 0 4px 20px rgba(66, 133, 244, 0.2);">
      <h2 style="color: white; margin-bottom: 20px;">ğŸ”— Google Workspace Integrations</h2>
      <p style="color: rgba(255,255,255,0.9); margin-bottom: 20px; font-size: 14px;">Conecte serviÃ§os do Google Workspace com 1 clique. OAuth gerenciado automaticamente pelo Replit.</p>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
        <!-- Gmail -->
        <div class="integration-card" data-integration="gmail" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.2s;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #EA4335 0%, #C5221F 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px;">ğŸ“§</div>
            <div style="flex: 1;">
              <h3 style="margin: 0; color: #202124; font-size: 16px;">Gmail</h3>
              <span class="status-badge" data-status="disconnected" style="font-size: 11px; padding: 2px 8px; border-radius: 4px; background: #f1f3f4; color: #5f6368;">Desconectado</span>
            </div>
          </div>
          <p style="color: #5f6368; font-size: 13px; margin-bottom: 15px;">Enviar e gerenciar emails automaticamente</p>
          <button onclick="conectarIntegracao('gmail')" class="btn-connect" style="width: 100%; padding: 10px; background: #4285F4; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: background 0.2s;" data-testid="button-connect-gmail">
            ğŸ”Œ Conectar
          </button>
        </div>

        <!-- Google Calendar -->
        <div class="integration-card" data-integration="calendar" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.2s;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #4285F4 0%, #1967D2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px;">ğŸ“…</div>
            <div style="flex: 1;">
              <h3 style="margin: 0; color: #202124; font-size: 16px;">Google Calendar</h3>
              <span class="status-badge" data-status="disconnected" style="font-size: 11px; padding: 2px 8px; border-radius: 4px; background: #f1f3f4; color: #5f6368;">Desconectado</span>
            </div>
          </div>
          <p style="color: #5f6368; font-size: 13px; margin-bottom: 15px;">Agendar eventos e reuniÃµes automaticamente</p>
          <button onclick="conectarIntegracao('calendar')" class="btn-connect" style="width: 100%; padding: 10px; background: #4285F4; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: background 0.2s;" data-testid="button-connect-calendar">
            ğŸ”Œ Conectar
          </button>
        </div>

        <!-- Google Sheets -->
        <div class="integration-card" data-integration="sheets" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.2s;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #34A853 0%, #188038 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px;">ğŸ“Š</div>
            <div style="flex: 1;">
              <h3 style="margin: 0; color: #202124; font-size: 16px;">Google Sheets</h3>
              <span class="status-badge" data-status="disconnected" style="font-size: 11px; padding: 2px 8px; border-radius: 4px; background: #f1f3f4; color: #5f6368;">Desconectado</span>
            </div>
          </div>
          <p style="color: #5f6368; font-size: 13px; margin-bottom: 15px;">Registrar dados em planilhas</p>
          <button onclick="conectarIntegracao('sheets')" class="btn-connect" style="width: 100%; padding: 10px; background: #4285F4; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: background 0.2s;" data-testid="button-connect-sheets">
            ğŸ”Œ Conectar
          </button>
        </div>

        <!-- Google Drive -->
        <div class="integration-card" data-integration="drive" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.2s;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #FBBC04 0%, #F9AB00 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px;">ğŸ“‚</div>
            <div style="flex: 1;">
              <h3 style="margin: 0; color: #202124; font-size: 16px;">Google Drive</h3>
              <span class="status-badge" data-status="disconnected" style="font-size: 11px; padding: 2px 8px; border-radius: 4px; background: #f1f3f4; color: #5f6368;">Desconectado</span>
            </div>
          </div>
          <p style="color: #5f6368; font-size: 13px; margin-bottom: 15px;">Gerenciar arquivos e documentos</p>
          <button onclick="conectarIntegracao('drive')" class="btn-connect" style="width: 100%; padding: 10px; background: #4285F4; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: background 0.2s;" data-testid="button-connect-drive">
            ğŸ”Œ Conectar
          </button>
        </div>

        <!-- Google Docs -->
        <div class="integration-card" data-integration="docs" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.2s;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #4285F4 0%, #1967D2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px;">ğŸ“</div>
            <div style="flex: 1;">
              <h3 style="margin: 0; color: #202124; font-size: 16px;">Google Docs</h3>
              <span class="status-badge" data-status="disconnected" style="font-size: 11px; padding: 2px 8px; border-radius: 4px; background: #f1f3f4; color: #5f6368;">Desconectado</span>
            </div>
          </div>
          <p style="color: #5f6368; font-size: 13px; margin-bottom: 15px;">Criar e editar documentos</p>
          <button onclick="conectarIntegracao('docs')" class="btn-connect" style="width: 100%; padding: 10px; background: #4285F4; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: background 0.2s;" data-testid="button-connect-docs">
            ğŸ”Œ Conectar
          </button>
        </div>

        <!-- Google People (Contacts) -->
        <div class="integration-card" data-integration="people" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.2s;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #34A853 0%, #188038 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px;">ğŸ‘¥</div>
            <div style="flex: 1;">
              <h3 style="margin: 0; color: #202124; font-size: 16px;">Google Contacts</h3>
              <span class="status-badge" data-status="disconnected" style="font-size: 11px; padding: 2px 8px; border-radius: 4px; background: #f1f3f4; color: #5f6368;">Desconectado</span>
            </div>
          </div>
          <p style="color: #5f6368; font-size: 13px; margin-bottom: 15px;">Sincronizar contatos e follow-ups</p>
          <button onclick="conectarIntegracao('people')" class="btn-connect" style="width: 100%; padding: 10px; background: #4285F4; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: background 0.2s;" data-testid="button-connect-people">
            ğŸ”Œ Conectar
          </button>
        </div>
      </div>

      <!-- Test Section -->
      <div id="integration-test-section" style="margin-top: 25px; background: white; border-radius: 12px; padding: 20px; display: none;">
        <h3 style="color: #202124; margin-bottom: 15px;">ğŸ§ª Testar IntegraÃ§Ã£o</h3>
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
          <select id="test-integration-select" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px;" data-testid="select-test-integration">
            <option value="">Selecione uma integraÃ§Ã£o...</option>
            <option value="gmail">Gmail - Enviar Email de Teste</option>
            <option value="calendar">Calendar - Criar Evento</option>
            <option value="sheets">Sheets - Adicionar Linha</option>
            <option value="drive">Drive - Listar Arquivos</option>
            <option value="docs">Docs - Criar Documento</option>
            <option value="people">Contacts - Listar Contatos</option>
          </select>
          <button onclick="testarIntegracao()" style="padding: 10px 25px; background: #34A853; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;" data-testid="button-test-integration">
            ğŸ§ª Testar
          </button>
        </div>
        <div id="test-result" style="background: #f8f9fa; border-radius: 8px; padding: 15px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; display: none;"></div>
      </div>
    </div>

    <!-- Agent Capabilities -->
    <div class="section">
      <h2>ğŸ¤– Available Agents</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
        <div style="padding: 20px; background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%); border-radius: 12px; box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);">
          <strong style="color: white; font-size: 16px;">ğŸ—ï¸ RBB_AgenteArquiteto (GPT-4)</strong>
          <p style="margin: 8px 0 0 0; color: rgba(255,255,255,0.9); font-size: 13px; font-weight: 500;">Arquiteto autÃ´nomo com IA. Gera planos, executa cÃ³digo, debuga automaticamente, cria soluÃ§Ãµes completas!</p>
        </div>
        <div style="padding: 20px; background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); border-radius: 12px; box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3);">
          <strong style="color: white; font-size: 16px;">ğŸ” RBB_AgenteAnalista (Claude) â­ NOVO!</strong>
          <p style="margin: 8px 0 0 0; color: rgba(255,255,255,0.9); font-size: 13px; font-weight: 500;">Analista expert com Claude. Code review profundo, debugging avanÃ§ado, otimizaÃ§Ã£o de cÃ³digo!</p>
        </div>
        <div style="padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #667eea;">
          <strong style="color: #667eea;">ğŸ RBB_AgenteExecutor (Python)</strong>
          <p style="margin: 8px 0 0 0; color: #666; font-size: 13px;">Executa scripts Python 3. Use para anÃ¡lise de dados, web scraping, ML, automaÃ§Ãµes.</p>
        </div>
        <div style="padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #10b981;">
          <strong style="color: #10b981;">ğŸ“¦ RBB_AgenteExecutor (Node.js)</strong>
          <p style="margin: 8px 0 0 0; color: #666; font-size: 13px;">Executa JavaScript/Node.js. Use para APIs, bots, processamento assÃ­ncrono.</p>
        </div>
        <div style="padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #f59e0b;">
          <strong style="color: #f59e0b;">â˜• RBB_AgenteExecutor (Java)</strong>
          <p style="margin: 8px 0 0 0; color: #666; font-size: 13px;">Compila e executa Java. Use para processamento robusto, integraÃ§Ã£o enterprise.</p>
        </div>
        <div style="padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #8b5cf6;">
          <strong style="color: #8b5cf6;">ğŸ“„ RBB_AgentePaginas</strong>
          <p style="margin: 8px 0 0 0; color: #666; font-size: 13px;">Gera pÃ¡ginas HTML dinÃ¢micas. Acesse em /pages/nome-da-pagina</p>
        </div>
        <div style="padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #ec4899;">
          <strong style="color: #ec4899;">ğŸ“§ RBB_AgenteEmail</strong>
          <p style="margin: 8px 0 0 0; color: #666; font-size: 13px;">Envia emails via Resend. Suporta HTML, anexos, templates.</p>
        </div>
        <div style="padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #06b6d4;">
          <strong style="color: #06b6d4;">ğŸ“œ RBB_AgenteLogs</strong>
          <p style="margin: 8px 0 0 0; color: #666; font-size: 13px;">Sistema de logging centralizado com nÃ­veis (info, warn, error).</p>
        </div>
        <div style="padding: 20px; background: linear-gradient(135deg, #24292e 0%, #1a1e22 100%); border-radius: 12px; box-shadow: 0 8px 20px rgba(36, 41, 46, 0.3);">
          <strong style="color: white; font-size: 16px;">ğŸš€ RBB_AgenteGitHub â­ NOVO!</strong>
          <p style="margin: 8px 0 0 0; color: rgba(255,255,255,0.9); font-size: 13px; font-weight: 500;">Envia pastas automaticamente para GitHub! Faz commit e push de cÃ³digo gerado pelos agentes.</p>
        </div>
      </div>
    </div>

    <!-- Recent Tasks -->
    <div class="section">
      <h2>ğŸ“‹ Recent Tasks</h2>
      <div id="tarefas-lista">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading tasks...</p>
        </div>
      </div>
    </div>

    <!-- Generated Pages -->
    <div class="section">
      <h2>ğŸŒ Generated Pages</h2>
      <div id="paginas-lista">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading pages...</p>
        </div>
      </div>
    </div>

    <!-- Recent Logs -->
    <div class="section">
      <h2>ğŸ“œ Recent Logs</h2>
      <div id="logs-lista">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading logs...</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const SUPABASE_URL = 'https://jllcpmosqwwkcrucfpcp.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpsbGNwbW9zcXd3a2NydWNmcGNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1NjYzNjQsImV4cCI6MjA3NTE0MjM2NH0.THsGuEXsRGxHat3M9wJOIpvR_0u9tD53BaAmDhHFSUg';
    
    // â­ Detecta se estÃ¡ na Vercel ou Replit
    const isVercel = window.location.hostname.includes('vercel.app');
    const API_BASE_URL = isVercel 
      ? 'https://42b6f037-6d7f-4b2d-8d89-92ea9e2e8f56-00-9hn1em5epzrs.picard.replit.dev'
      : '';
    
    console.log('ğŸŒ Ambiente:', isVercel ? 'VERCEL' : 'REPLIT');
    console.log('ğŸ”— API Base URL:', API_BASE_URL || 'Local');
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function login() {
      const password = document.getElementById('password-input').value;
      if (password === 'alpha2') {
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('dashboard').classList.remove('hidden');
        inicializarDashboard();
      } else {
        alert('âŒ Incorrect password');
      }
    }

    function logout() {
      document.getElementById('dashboard').classList.add('hidden');
      document.getElementById('login-screen').classList.remove('hidden');
      document.getElementById('password-input').value = '';
    }

    async function atualizarDashboard() {
      const hoje = new Date();
      hoje.setHours(0, 0, 0, 0);

      const { data, error } = await supabase
        .from('agentes_tarefas')
        .select('status')
        .gte('created_at', hoje.toISOString());

      if (error) {
        console.error('Error loading stats:', error);
        return;
      }

      const stats = {
        fila: 0,
        processando: 0,
        concluido: 0,
        erro: 0
      };

      data.forEach(t => {
        if (stats[t.status] !== undefined) {
          stats[t.status]++;
        }
      });

      document.getElementById('count-fila').textContent = stats.fila;
      document.getElementById('count-processando').textContent = stats.processando;
      document.getElementById('count-concluido').textContent = stats.concluido;
      document.getElementById('count-erro').textContent = stats.erro;
    }

    async function testarEmail() {
      const email = prompt('Enter your email for testing:');
      if (!email) return;

      const { error } = await supabase
        .from('agentes_tarefas')
        .insert({
          agente: 'RBB_AgenteEmail',
          tipo: 'send_email',
          payload: {
            to: email,
            subject: 'ğŸš€ RBB Test',
            html: '<h1>It worked!</h1><p>Your agent system is active.</p>'
          },
          status: 'fila',
          prioridade: 5
        });

      if (!error) {
        alert('âœ… Email queued! Check inbox in a few seconds.');
        setTimeout(refreshAll, 1000);
      } else {
        alert('âŒ Error: ' + error.message);
      }
    }

    async function testarPagina() {
      const pathName = 'test-' + Date.now();
      const { error } = await supabase
        .from('agentes_tarefas')
        .insert({
          agente: 'RBB_AgentePaginas',
          tipo: 'gen_page',
          payload: {
            pathName: pathName,
            html: `<!DOCTYPE html>
<html>
<head>
  <title>Test Page</title>
  <style>
    body { font-family: system-ui; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: flex; align-items: center; justify-content: center; min-height: 100vh; text-align: center; }
  </style>
</head>
<body>
  <div>
    <h1>âœ… Test Page Generated!</h1>
    <p>Created at ${new Date().toLocaleString()}</p>
    <p>This page was generated by RBB_AgentePaginas</p>
  </div>
</body>
</html>`
          },
          status: 'fila',
          prioridade: 5
        });

      if (!error) {
        alert('âœ… Page queued! Will open in 6 seconds...');
        setTimeout(() => {
          window.open('/pages/' + pathName, '_blank');
        }, 6000);
        setTimeout(refreshAll, 1000);
      } else {
        alert('âŒ Error: ' + error.message);
      }
    }

    async function testarPython() {
      const { error } = await supabase
        .from('agentes_tarefas')
        .insert({
          agente: 'RBB_AgenteExecutor',
          tipo: 'execute_code',
          payload: {
            language: 'python',
            code: `import datetime
import sys

print("ğŸ Python Agent Test")
print(f"Time: {datetime.datetime.now()}")
print(f"Python version: {sys.version}")
print("âœ… Success!")`,
            args: []
          },
          status: 'fila',
          prioridade: 5
        });

      if (!error) {
        alert('âœ… Python code queued!');
        setTimeout(refreshAll, 1000);
      } else {
        alert('âŒ Error: ' + error.message);
      }
    }

    async function testarNode() {
      const { error } = await supabase
        .from('agentes_tarefas')
        .insert({
          agente: 'RBB_AgenteExecutor',
          tipo: 'execute_code',
          payload: {
            language: 'node',
            code: `console.log("ğŸ“¦ Node.js Agent Test");
console.log("Time:", new Date().toISOString());
console.log("Node version:", process.version);
console.log("âœ… Success!");`,
            args: []
          },
          status: 'fila',
          prioridade: 5
        });

      if (!error) {
        alert('âœ… Node.js code queued!');
        setTimeout(refreshAll, 1000);
      } else {
        alert('âŒ Error: ' + error.message);
      }
    }

    async function testarJava() {
      const { error } = await supabase
        .from('agentes_tarefas')
        .insert({
          agente: 'RBB_AgenteExecutor',
          tipo: 'execute_code',
          payload: {
            language: 'java',
            code: `public class TestAgent {
    public static void main(String[] args) {
        System.out.println("â˜• Java Agent Test");
        System.out.println("Time: " + java.time.LocalDateTime.now());
        System.out.println("Java version: " + System.getProperty("java.version"));
        System.out.println("âœ… Success!");
    }
}`,
            args: []
          },
          status: 'fila',
          prioridade: 5
        });

      if (!error) {
        alert('âœ… Java code queued!');
        setTimeout(refreshAll, 1000);
      } else {
        alert('âŒ Error: ' + error.message);
      }
    }

    // FunÃ§Ãµes para gerenciar modelo GPT
    async function carregarModeloAtual() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/config-modelo-gpt`);
        if (response.ok) {
          const data = await response.json();
          document.getElementById('modelo-atual').textContent = data.model || 'gpt-4o-mini';
          document.getElementById('modelo-gpt-select').value = data.model || 'gpt-4o-mini';
        }
      } catch (error) {
        console.error('Erro ao carregar modelo:', error);
        document.getElementById('modelo-atual').textContent = 'gpt-4o-mini (padrÃ£o)';
      }
    }

    async function mudarModeloGPT() {
      const modeloSelecionado = document.getElementById('modelo-gpt-select').value;
      const statusDiv = document.getElementById('modelo-status');
      const statusP = statusDiv.querySelector('p');

      statusP.textContent = 'â³ Alterando modelo...';
      statusDiv.style.display = 'block';
      statusDiv.style.background = '#fef3c7';
      statusDiv.style.borderColor = '#f59e0b';
      statusP.style.color = '#f59e0b';

      try {
        const response = await fetch(`${API_BASE_URL}/api/config-modelo-gpt`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ modelo: modeloSelecionado })
        });

        if (response.ok) {
          const data = await response.json();
          document.getElementById('modelo-atual').textContent = modeloSelecionado;
          
          statusP.textContent = `âœ… Modelo alterado para ${modeloSelecionado}!`;
          statusDiv.style.background = '#d1fae5';
          statusDiv.style.borderColor = '#10b981';
          statusP.style.color = '#10b981';

          setTimeout(() => {
            statusDiv.style.display = 'none';
          }, 5000);
        } else {
          throw new Error('Erro ao alterar modelo');
        }
      } catch (error) {
        statusP.textContent = `âŒ Erro: ${error.message}`;
        statusDiv.style.background = '#fee2e2';
        statusDiv.style.borderColor = '#ef4444';
        statusP.style.color = '#ef4444';
      }
    }

    async function verModeloAtual() {
      await carregarModeloAtual();
      
      const modeloAtual = document.getElementById('modelo-atual').textContent;
      const custos = {
        'gpt-4o-mini': '$0.15/1M tokens (BARATO)',
        'gpt-3.5-turbo': '$0.50/1M tokens (MUITO BARATO)',
        'gpt-4o': '$2.50/1M tokens (MÃ‰DIO)',
        'gpt-4-turbo': '$10/1M tokens (CARO)'
      };

      const statusDiv = document.getElementById('modelo-status');
      const statusP = statusDiv.querySelector('p');
      
      statusP.innerHTML = `ğŸ“Š <strong>Modelo Atual:</strong> ${modeloAtual}<br>ğŸ’° <strong>Custo:</strong> ${custos[modeloAtual.split(' ')[0]] || 'Desconhecido'}`;
      statusDiv.style.display = 'block';
      statusDiv.style.background = '#f0f9ff';
      statusDiv.style.borderColor = '#0284c7';
      statusP.style.color = '#0284c7';

      setTimeout(() => {
        statusDiv.style.display = 'none';
      }, 8000);
    }

    let chatHistory = [];
    let imagemAnexada = null;
    let tarefaAtualId = null;
    let monitorandoTarefa = false;
    let intervaloMonitoramento = null;

    function limparEstadoMonitoramento() {
      console.log('ğŸ§¹ Limpando estado de monitoramento...');
      monitorandoTarefa = false;
      if (intervaloMonitoramento) {
        clearInterval(intervaloMonitoramento);
        intervaloMonitoramento = null;
      }
      ocultarProgresso();
    }

    async function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      console.log('ğŸ“¤ Iniciando upload da imagem:', file.name);

      const reader = new FileReader();
      reader.onload = async function(e) {
        const base64Data = e.target.result;
        
        // Mostra preview imediatamente
        document.getElementById('preview-img').src = base64Data;
        document.getElementById('preview-name').textContent = `â³ Enviando ${file.name}...`;
        document.getElementById('image-preview').style.display = 'block';
        
        try {
          // Faz upload da imagem para o servidor
          console.log('ğŸŒ Fazendo upload para /api/upload-image...');
          const response = await fetch(`${API_BASE_URL}/api/upload-image`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              imageData: base64Data,
              fileName: file.name
            })
          });
          
          if (!response.ok) {
            throw new Error('Erro ao fazer upload da imagem');
          }
          
          const result = await response.json();
          console.log('âœ… Upload completo:', result);
          
          // Armazena URL pÃºblica da imagem
          imagemAnexada = {
            nome: file.name,
            tipo: file.type,
            url: result.url,
            base64: base64Data
          };
          
          document.getElementById('preview-name').textContent = `âœ… ${file.name} - Pronto!`;
          console.log('âœ… Upload completo');
          console.log('ğŸ“¦ imagemAnexada:', imagemAnexada);
          
        } catch (error) {
          console.error('âŒ Erro ao fazer upload:', error);
          document.getElementById('preview-name').textContent = `âš ï¸ ${file.name} - Modo local`;
          
          // MantÃ©m base64 como fallback
          imagemAnexada = {
            nome: file.name,
            tipo: file.type,
            base64: base64Data
          };
          console.log('âš ï¸ Usando fallback');
          console.log('ğŸ“¦ imagemAnexada (fallback):', imagemAnexada);
        }
      };
      reader.readAsDataURL(file);
    }

    function removerImagem() {
      imagemAnexada = null;
      document.getElementById('image-preview').style.display = 'none';
      document.getElementById('chat-file-input').value = '';
    }

    function atualizarProgresso(texto, porcentagem) {
      const progressoDiv = document.getElementById('progresso-arquiteto');
      const progressoTexto = document.getElementById('progresso-texto');
      const progressoBarra = document.getElementById('progresso-barra');
      
      progressoDiv.style.display = 'block';
      progressoTexto.textContent = texto;
      progressoBarra.style.width = porcentagem + '%';
    }

    function ocultarProgresso() {
      document.getElementById('progresso-arquiteto').style.display = 'none';
    }

    function adicionarMensagemChat(tipo, texto, timestamp = new Date(), imageUrl = null) {
      const mensagem = { tipo, texto, timestamp, imageUrl };
      chatHistory.push(mensagem);
      
      const container = document.getElementById('chat-messages');
      const chatContainer = document.getElementById('chat-container');
      const isUser = tipo === 'user';
      
      // HTML da imagem se houver
      const imagemHtml = imageUrl ? `
        <div style="margin-top: 8px;">
          <img src="${imageUrl}" style="max-width: 100%; border-radius: 8px; border: 1px solid rgba(0,0,0,0.1);" alt="Imagem anexada" />
        </div>
      ` : '';
      
      const html = `
        <div style="margin-bottom: 15px; display: flex; justify-content: ${isUser ? 'flex-end' : 'flex-start'};">
          <div style="max-width: 70%; padding: 12px 16px; border-radius: 12px; ${isUser ? 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;' : 'background: #f8fafc; color: #333;'}">
            <strong style="display: block; margin-bottom: 5px; font-size: 12px; opacity: 0.8;">
              ${isUser ? 'ğŸ‘¤ VocÃª' : 'ğŸ¤– Arquiteto IA'}
            </strong>
            <div style="white-space: pre-wrap; word-break: break-word;">${texto}</div>
            ${imagemHtml}
            <small style="display: block; margin-top: 5px; font-size: 11px; opacity: 0.7;">
              ${timestamp.toLocaleTimeString()}
            </small>
          </div>
        </div>
      `;
      
      container.insertAdjacentHTML('beforeend', html);
      
      // FORÃ‡A SCROLL PARA O FINAL - DUPLO
      setTimeout(() => {
        chatContainer.scrollTop = chatContainer.scrollHeight;
        chatContainer.scrollIntoView({ behavior: 'smooth', block: 'end' });
      }, 100);
    }

    async function enviarMensagem() {
      console.log('========================================');
      console.log('ğŸ”˜ BOTÃƒO VERDE CLICADO!');
      console.log('========================================');
      
      const input = document.getElementById('chat-input');
      const mensagem = input.value.trim();
      
      console.log('ğŸ“‹ Estado COMPLETO:', {
        mensagem: mensagem,
        mensagem_length: mensagem.length,
        imagemAnexada: imagemAnexada,
        tem_imagem: !!imagemAnexada
      });
      
      if (!mensagem && !imagemAnexada) {
        console.log('âš ï¸ BLOQUEADO: Nada para enviar');
        alert('Digite uma mensagem ou anexe uma imagem!');
        return;
      }
      
      console.log('âœ… PASSOU VALIDAÃ‡ÃƒO - Continuando...');
      
      // Limpa qualquer monitoramento anterior
      limparEstadoMonitoramento();
      
      // ConstrÃ³i mensagem com imagem se houver
      let mensagemCompleta = mensagem;
      let imageUrl = null;
      
      if (imagemAnexada) {
        mensagemCompleta += '\n\n[Imagem anexada: ' + imagemAnexada.nome + ']';
        imageUrl = imagemAnexada.url || imagemAnexada.base64;
      }
      
      // Adiciona mensagem do usuÃ¡rio (com imagem se houver)
      adicionarMensagemChat('user', mensagemCompleta, new Date(), imageUrl);
      input.value = '';
      
      // Mostra progresso em tempo real
      atualizarProgresso('ğŸ§  Analisando sua mensagem...', 10);
      
      try {
        // TIMEOUT DE 60 SEGUNDOS
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 60000);
        
        // CHAMA O CHAT INTELIGENTE - ele decide se Ã© conversa, tarefa ou ajuste
        const response = await fetch(`${API_BASE_URL}/api/chat-central-inteligente`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            mensagem: mensagem,
            historico: chatHistory.slice(-10),
            ultima_tarefa_id: tarefaAtualId,
            imagem: imagemAnexada
          }),
          signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        
        if (!response.ok) {
          throw new Error(`Erro HTTP ${response.status}`);
        }
        
        const resultado = await response.json();
        
        // Se for sÃ³ conversa, responde e pronto
        if (resultado.tipo === 'conversa') {
          limparEstadoMonitoramento();
          adicionarMensagemChat('ai', resultado.resposta);
          removerImagem();
          return;
        }
        
        // Se for tarefa ou ajuste, monitora execuÃ§Ã£o
        if (resultado.execucao) {
          tarefaAtualId = resultado.tarefa_id;
          
          atualizarProgresso('âœ… Entendido! Vou executar agora...', 30);
          adicionarMensagemChat('ai', resultado.resposta);
          
          // Remove imagem anexada
          removerImagem();
          
          // Monitora progresso e resultado
          monitorarProgressoArquiteto();
          monitorarResultadoTarefa(tarefaAtualId);
          
          setTimeout(refreshAll, 1000);
        }
        
      } catch (error) {
        console.error('âŒ Erro no enviarMensagem:', error);
        limparEstadoMonitoramento();
        
        let mensagemErro = 'âŒ Erro ao processar sua mensagem.\n\n';
        if (error.name === 'AbortError') {
          mensagemErro += 'A requisiÃ§Ã£o demorou muito (timeout de 60s). Tente novamente.';
        } else {
          mensagemErro += error.message || 'Erro desconhecido';
        }
        
        adicionarMensagemChat('ai', mensagemErro);
        removerImagem();
      }
    }
    
    async function monitorarProgressoArquiteto() {
      // Simula progresso enquanto aguarda
      const etapas = [
        { texto: 'ğŸ” Analisando sua solicitaÃ§Ã£o...', porcentagem: 40, tempo: 3000 },
        { texto: 'ğŸ—ï¸ Gerando plano de execuÃ§Ã£o...', porcentagem: 60, tempo: 3000 },
        { texto: 'âš™ï¸ Executando tarefas...', porcentagem: 80, tempo: 5000 }
      ];
      
      for (const etapaInfo of etapas) {
        await new Promise(resolve => setTimeout(resolve, etapaInfo.tempo));
        if (monitorandoTarefa) {
          atualizarProgresso(etapaInfo.texto, etapaInfo.porcentagem);
        }
      }
    }

    async function monitorarResultadoTarefa(tarefaId) {
      monitorandoTarefa = true;
      let tentativas = 0;
      const maxTentativas = 60; // 60 tentativas x 2s = 2 minutos
      
      intervaloMonitoramento = setInterval(async () => {
        tentativas++;
        
        try {
          // Busca status da tarefa
          const { data, error } = await supabase
            .from('agentes_tarefas')
            .select('*')
            .eq('id', tarefaId)
            .single();
          
          // Se deu erro ou excedeu tentativas
          if (error || tentativas >= maxTentativas) {
            console.error('âš ï¸ Erro ou timeout no monitoramento:', error);
            limparEstadoMonitoramento();
            
            if (tentativas >= maxTentativas) {
              adicionarMensagemChat('ai', 'â±ï¸ A tarefa estÃ¡ demorando mais que o esperado. Continue acompanhando nas seÃ§Ãµes abaixo.');
            } else if (error) {
              adicionarMensagemChat('ai', 'âŒ Erro ao monitorar tarefa. Verifique as seÃ§Ãµes abaixo.');
            }
            return;
          }
        
        // Atualiza progresso visual
        if (data.status === 'processando') {
          atualizarProgresso('âš™ï¸ Arquiteto trabalhando agora...', 85);
        }
        
          // Se concluiu com sucesso
          if (data.status === 'concluido') {
            limparEstadoMonitoramento();
            
            atualizarProgresso('âœ… Tarefa concluÃ­da!', 100);
          
          // Busca mensagem formatada ou gera relatÃ³rio
          let relatorio = '';
          
          try {
            const resultado = typeof data.resultado === 'string' ? JSON.parse(data.resultado) : data.resultado;
            
            // â­ PRIORIDADE: Usa mensagem_chat do Arquiteto se existir
            if (resultado.mensagem_chat) {
              console.log('âœ… USANDO MENSAGEM DO ARQUITETO');
              relatorio = resultado.mensagem_chat;
            } else {
              // Gera relatÃ³rio padrÃ£o
              console.log('ğŸ“ GERANDO RELATÃ“RIO PADRÃƒO');
              relatorio = 'âœ… **PRONTO! TAREFA CONCLUÃDA**\n\n';
              
              if (resultado.mensagem) {
                relatorio += resultado.mensagem + '\n\n';
              }
              
              if (resultado.detalhes) {
                relatorio += 'ğŸ“‹ **Detalhes:**\n';
                if (typeof resultado.detalhes === 'string') {
                  relatorio += resultado.detalhes + '\n\n';
                } else {
                  relatorio += JSON.stringify(resultado.detalhes, null, 2) + '\n\n';
                }
              }
              
              if (resultado.arquivos || resultado.paginas) {
                relatorio += 'ğŸ“ **Arquivos criados:**\n';
                const arquivos = resultado.arquivos || resultado.paginas || [];
                if (Array.isArray(arquivos)) {
                  arquivos.forEach(arq => relatorio += `â€¢ ${arq}\n`);
                } else {
                  relatorio += `â€¢ ${arquivos}\n`;
                }
                relatorio += '\n';
              }
              
              relatorio += '\nğŸ’¬ **Precisa de algum ajuste?** Pode pedir aqui mesmo que eu executo!\n\n';
              relatorio += 'ğŸ”§ Exemplos:\n';
              relatorio += 'â€¢ "Muda a cor para azul"\n';
              relatorio += 'â€¢ "Adiciona uma seÃ§Ã£o de FAQ"\n';
              relatorio += 'â€¢ "Aumenta o tamanho da fonte"';
            }
            
          } catch (e) {
            // Se nÃ£o conseguir parsear, mostra resultado bruto
            console.log('âš ï¸ ERRO AO PARSEAR, MOSTRANDO BRUTO');
            relatorio = 'âœ… **TAREFA CONCLUÃDA**\n\n' + data.resultado;
          }
          
          // POSTA RELATÃ“RIO NO CHAT
          console.log('ğŸ“¢ POSTANDO RELATÃ“RIO NO CHAT (primeiras 100 chars):', relatorio.substring(0, 100));
          adicionarMensagemChat('ai', relatorio);
          ocultarProgresso();
          
          setTimeout(refreshAll, 2000);
        }
        
          // Se deu erro
          if (data.status === 'erro') {
            limparEstadoMonitoramento();
          
          let msgErro = 'âŒ **Ops! Ocorreu um erro durante a execuÃ§Ã£o.**\n\n';
          try {
            const resultado = typeof data.resultado === 'string' ? JSON.parse(data.resultado) : data.resultado;
            if (resultado.error && resultado.error.message) {
              msgErro += '**Erro:** ' + resultado.error.message + '\n\n';
            } else {
              msgErro += data.resultado + '\n\n';
            }
          } catch (e) {
            msgErro += data.resultado + '\n\n';
          }
          
          msgErro += '\nğŸ’¡ Quer que eu tente de novo de outra forma? Me diga o que quer!';
          
          // POSTA ERRO NO CHAT
          console.log('âŒ POSTANDO ERRO NO CHAT');
          adicionarMensagemChat('ai', msgErro);
          setTimeout(refreshAll, 1000);
          }
          
        } catch (error) {
          console.error('âŒ Erro no monitoramento:', error);
          limparEstadoMonitoramento();
          adicionarMensagemChat('ai', 'âŒ Erro ao monitorar a execuÃ§Ã£o da tarefa. Tente novamente.');
        }
        
      }, 2000); // Verifica a cada 2 segundos
    }

    async function testarCodeReview() {
      const codigo = prompt('Cole o cÃ³digo que quer revisar:\n\n(Claude vai fazer um code review profundo)');
      if (!codigo) return;

      const { error } = await supabase
        .from('agentes_tarefas')
        .insert({
          agente: 'RBB_AgenteAnalista',
          tipo: 'code_review',
          payload: {
            tipo: 'code_review',
            codigo,
            descricao: 'Code review completo'
          },
          status: 'fila',
          prioridade: 8
        });

      if (!error) {
        alert('ğŸ” Claude iniciou o code review!\n\nResultado aparecerÃ¡ nos logs em 10-15 segundos.');
        setTimeout(refreshAll, 1000);
      } else {
        alert('âŒ Error: ' + error.message);
      }
    }

    async function pushDiretoGitHub() {
      const pasta = document.getElementById('github-pasta').value.trim();
      const repo = document.getElementById('github-repo').value.trim();
      const branch = document.getElementById('github-branch').value.trim() || 'main';
      const mensagem = document.getElementById('github-mensagem').value.trim();
      const destino = document.getElementById('github-destino').value.trim();

      if (!pasta) {
        alert('âŒ Informe a pasta local!');
        return;
      }

      if (!repo) {
        alert('âŒ Informe o repositÃ³rio (usuario/repo)!');
        return;
      }

      if (!mensagem) {
        alert('âŒ Informe a mensagem do commit!');
        return;
      }

      const confirmacao = confirm(`âš¡ PUSH DIRETO (sem agente)\n\nğŸ“ Pasta: ${pasta}\nğŸ“¦ Repo: ${repo}\nğŸŒ¿ Branch: ${branch}\nğŸ“ Commit: ${mensagem}${destino ? '\nğŸ“‚ Destino: ' + destino : ''}\n\nâœ“ Mais rÃ¡pido (5-10s)`);
      
      if (!confirmacao) return;

      try {
        const loadingMsg = alert('â³ Enviando para GitHub...\n\nAguarde 5-10 segundos.');

        const response = await fetch(`${API_BASE_URL}/api/github-push-direct`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            pasta_local: pasta,
            repositorio: repo,
            branch: branch,
            mensagem_commit: mensagem,
            pasta_destino: destino || null
          })
        });

        const result = await response.json();

        if (result.success) {
          alert(`âœ… ${result.message}\n\nğŸ“¦ RepositÃ³rio: ${result.repo}\nğŸŒ¿ Branch: ${result.branch}`);
          document.getElementById('github-pasta').value = '';
          document.getElementById('github-mensagem').value = '';
          document.getElementById('github-destino').value = '';
        } else {
          alert(`âŒ Erro no push:\n\n${result.error}`);
        }

      } catch (error) {
        alert(`âŒ Erro ao conectar:\n\n${error.message}`);
      }
    }

    async function pullRapidoGitHub() {
      const repo = document.getElementById('github-pull-quick-repo').value.trim();

      if (!repo) {
        alert('âŒ Informe o repositÃ³rio (usuario/repo)!');
        return;
      }

      const confirmacao = confirm(`ğŸ“¥ PULL RÃPIDO DO GITHUB\n\nğŸ“¦ Repo: ${repo}\nğŸŒ¿ Branch: main\n\nâœ“ Download em 5-10s\nâœ“ Salvo em: github_downloads/${repo.split('/')[1]}`);
      
      if (!confirmacao) return;

      const btn = event.target;
      const textoOriginal = btn.innerHTML;
      btn.disabled = true;
      btn.innerHTML = 'â³ Baixando...';

      try {
        const response = await fetch(`${API_BASE_URL}/api/github-pull-direct`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            repositorio: repo,
            branch: 'main',
            pasta_destino: ''
          })
        });

        const result = await response.json();

        if (result.success) {
          alert(`âœ… PULL CONCLUÃDO!\n\nğŸ“ Salvo em: ${result.localPath}\nğŸ“¦ Repo: ${repo}`);
          document.getElementById('github-pull-quick-repo').value = '';
        } else {
          alert(`âŒ Erro no PULL:\n\n${result.error || 'Erro desconhecido'}`);
        }
      } catch (error) {
        alert(`âŒ Erro ao conectar:\n\n${error.message}`);
      } finally {
        btn.disabled = false;
        btn.innerHTML = textoOriginal;
      }
    }

    async function pullDiretoGitHub() {
      const repo = document.getElementById('github-pull-repo').value.trim();
      const branch = document.getElementById('github-pull-branch').value.trim() || 'main';
      const pasta = document.getElementById('github-pull-pasta').value.trim();

      if (!repo) {
        alert('âŒ Informe o repositÃ³rio (usuario/repo)!');
        return;
      }

      const confirmacao = confirm(`ğŸ“¥ PULL DO GITHUB\n\nğŸ“¦ Repo: ${repo}\nğŸŒ¿ Branch: ${branch}${pasta ? '\nğŸ“‚ Pasta: ' + pasta : '\nğŸ“‚ Pasta: (todo o repo)'}\n\nâœ“ Download em 5-10s\nâœ“ Salvo em: github_downloads/${repo.split('/')[1]}`);
      
      if (!confirmacao) return;

      const resultDiv = document.getElementById('pull-result');
      const resultContent = document.getElementById('pull-result-content');
      
      resultDiv.style.display = 'block';
      resultContent.innerHTML = '<div style="text-align: center;"><div style="display: inline-block; width: 20px; height: 20px; border: 3px solid #10b981; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div><p style="margin-top: 10px; color: #10b981; font-weight: bold;">ğŸ“¥ Baixando cÃ³digo do GitHub...</p></div>';

      try {
        const response = await fetch(`${API_BASE_URL}/api/github-pull-direct`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            repositorio: repo,
            branch: branch,
            pasta_destino: pasta || ''
          })
        });

        const result = await response.json();

        if (result.success) {
          resultContent.innerHTML = `
            <h4 style="margin: 0 0 10px 0; color: #10b981;">âœ… ${result.mensagem}</h4>
            <div style="background: white; padding: 12px; border-radius: 6px; margin-top: 10px; font-size: 14px;">
              <p style="margin: 5px 0;"><strong>ğŸ“¦ RepositÃ³rio:</strong> ${result.repositorio}</p>
              <p style="margin: 5px 0;"><strong>ğŸŒ¿ Branch:</strong> ${result.branch}</p>
              <p style="margin: 5px 0;"><strong>ğŸ“‚ Pasta Baixada:</strong> ${result.pasta_destino}</p>
              <p style="margin: 5px 0;"><strong>ğŸ’¾ Salvo em:</strong> <code style="background: #f3f4f6; padding: 2px 6px; border-radius: 4px;">${result.pasta_local}</code></p>
              <p style="margin: 5px 0;"><strong>ğŸ“„ Total de arquivos:</strong> ${result.total_arquivos}</p>
              <details style="margin-top: 10px;">
                <summary style="cursor: pointer; color: #3b82f6; font-weight: bold;">Ver arquivos (primeiros 10)</summary>
                <pre style="background: #f3f4f6; padding: 10px; border-radius: 4px; margin-top: 5px; font-size: 12px; overflow-x: auto;">${result.arquivos_exemplo.join('\n')}</pre>
              </details>
            </div>
          `;
          
          document.getElementById('github-pull-repo').value = '';
          document.getElementById('github-pull-pasta').value = '';
        } else {
          resultDiv.style.background = '#fee2e2';
          resultDiv.style.borderColor = '#ef4444';
          resultContent.innerHTML = `
            <h4 style="margin: 0 0 10px 0; color: #ef4444;">âŒ Erro no Pull</h4>
            <p style="color: #991b1b;">${result.error}</p>
            ${result.detalhes ? `<p style="color: #991b1b; font-size: 12px; margin-top: 5px;"><em>${result.detalhes}</em></p>` : ''}
          `;
        }

      } catch (error) {
        alert(`âŒ Erro ao enviar:\n\n${error.message}`);
      }
    }

    async function enviarParaGitHub() {
      const pasta = document.getElementById('github-pasta').value.trim();
      const repo = document.getElementById('github-repo').value.trim();
      const branch = document.getElementById('github-branch').value.trim() || 'main';
      const mensagem = document.getElementById('github-mensagem').value.trim();
      const destino = document.getElementById('github-destino').value.trim();

      if (!pasta) {
        alert('âŒ Informe a pasta local!');
        return;
      }

      if (!repo) {
        alert('âŒ Informe o repositÃ³rio (usuario/repo)!');
        return;
      }

      if (!mensagem) {
        alert('âŒ Informe a mensagem do commit!');
        return;
      }

      const confirmacao = confirm(`ğŸ¤– PUSH VIA AGENTE (com fila)\n\nğŸ“ Pasta: ${pasta}\nğŸ“¦ Repo: ${repo}\nğŸŒ¿ Branch: ${branch}\nğŸ“ Commit: ${mensagem}${destino ? '\nğŸ“‚ Destino: ' + destino : ''}\n\nâ±ï¸ Tempo: 10-20s (via fila)`);
      
      if (!confirmacao) return;

      const { error } = await supabase
        .from('agentes_tarefas')
        .insert({
          agente: 'RBB_AgenteGitHub',
          tipo: 'push_github',
          payload: {
            pasta_local: pasta,
            repositorio: repo,
            branch: branch,
            mensagem_commit: mensagem,
            pasta_destino: destino || null
          },
          status: 'fila',
          prioridade: 7
        });

      if (!error) {
        alert('ğŸš€ Push para GitHub iniciado!\n\nAcompanhe nos logs. Isso pode levar 10-20 segundos.');
        document.getElementById('github-pasta').value = '';
        document.getElementById('github-mensagem').value = '';
        document.getElementById('github-destino').value = '';
        setTimeout(refreshAll, 1000);
      } else {
        alert('âŒ Erro: ' + error.message);
      }
    }

    async function executarShell() {
      const input = document.getElementById('shell-command');
      const command = input.value.trim();
      const output = document.getElementById('shell-output');

      if (!command) return;

      const timestamp = new Date().toLocaleTimeString();
      output.innerHTML += `<div style="color: #22d3ee; margin-top: 10px;">$ ${command}</div>`;
      output.innerHTML += `<div style="color: #fbbf24;">â³ Executando...</div>`;
      output.scrollTop = output.scrollHeight;

      try {
        const response = await fetch(`${API_BASE_URL}/api/shell`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ command })
        });

        const result = await response.json();

        const lastLoading = output.querySelector('div:last-child');
        if (lastLoading && lastLoading.textContent.includes('â³')) {
          lastLoading.remove();
        }

        if (result.success) {
          output.innerHTML += `<div style="color: #86efac;">${result.output}</div>`;
          output.innerHTML += `<div style="color: #64748b; font-size: 11px; margin-top: 5px;">âœ“ Completed in ${result.duration}ms [${timestamp}]</div>`;
        } else {
          output.innerHTML += `<div style="color: #fca5a5;">${result.output}</div>`;
          output.innerHTML += `<div style="color: #64748b; font-size: 11px; margin-top: 5px;">âœ— Exit code ${result.exitCode} (${result.duration}ms) [${timestamp}]</div>`;
        }

      } catch (error) {
        const lastLoading = output.querySelector('div:last-child');
        if (lastLoading && lastLoading.textContent.includes('â³')) {
          lastLoading.remove();
        }
        output.innerHTML += `<div style="color: #fca5a5;">âŒ Error: ${error.message}</div>`;
      }

      output.scrollTop = output.scrollHeight;
      input.value = '';
    }

    function limparShell() {
      document.getElementById('shell-output').innerHTML = '<div style="color: #64748b; font-style: italic;">Terminal cleared. Ready for commands...</div>';
    }

    function toggleChat() {
      const sidebar = document.getElementById('chat-sidebar');
      const toggleBtn = document.getElementById('chat-toggle-btn');
      
      sidebar.classList.toggle('open');
      toggleBtn.classList.toggle('open');
    }

    let sidebarChatHistory = [];

    function adicionarMensagemSidebar(tipo, texto) {
      const container = document.getElementById('sidebar-chat-messages');
      const timestamp = new Date();
      
      sidebarChatHistory.push({ tipo, texto, timestamp });
      
      const isUser = tipo === 'user';
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `chat-message ${tipo}`;
      
      messageDiv.innerHTML = `
        <div class="chat-avatar">${isUser ? 'ğŸ‘¤ VocÃª' : 'ğŸ¤– Arquiteto IA'}</div>
        <div class="chat-bubble">${texto}</div>
        <div class="chat-time">${timestamp.toLocaleTimeString()}</div>
      `;
      
      container.appendChild(messageDiv);
      container.scrollTop = container.scrollHeight;
    }

    let imagemAnexadaSidebar = null;

    function handleImageUploadSidebar(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        imagemAnexadaSidebar = {
          nome: file.name,
          tipo: file.type,
          base64: e.target.result
        };
        
        document.getElementById('sidebar-preview-img').src = e.target.result;
        document.getElementById('sidebar-preview-name').textContent = file.name;
        document.getElementById('sidebar-image-preview').style.display = 'block';
      };
      reader.readAsDataURL(file);
    }

    function removerImagemSidebar() {
      imagemAnexadaSidebar = null;
      document.getElementById('sidebar-image-preview').style.display = 'none';
      document.getElementById('sidebar-file-input').value = '';
    }

    async function enviarMensagemSidebar() {
      const input = document.getElementById('sidebar-chat-input');
      const sendBtn = document.getElementById('sidebar-send-btn');
      const mensagem = input.value.trim();
      
      if (!mensagem && !imagemAnexadaSidebar) return;
      
      let mensagemCompleta = mensagem;
      if (imagemAnexadaSidebar) {
        mensagemCompleta += '\n\n[Imagem anexada: ' + imagemAnexadaSidebar.nome + ']';
      }
      
      adicionarMensagemSidebar('user', mensagemCompleta);
      input.value = '';
      sendBtn.disabled = true;
      
      const loadingMsg = adicionarMensagemSidebar('ai', 'ğŸ’­ Pensando...');
      
      try {
        const payload = {
          mensagem: mensagem,
          historico: sidebarChatHistory.slice(-10)
        };
        
        if (imagemAnexadaSidebar) {
          payload.imagem = imagemAnexadaSidebar;
        }
        
        const response = await fetch(`${API_BASE_URL}/api/chat-ia`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        const data = await response.json();
        
        const container = document.getElementById('sidebar-chat-messages');
        container.removeChild(container.lastChild);

        if (data.success) {
          adicionarMensagemSidebar('ai', data.resposta);
        } else {
          adicionarMensagemSidebar('ai', `âŒ Erro: ${data.error || 'Erro ao processar mensagem'}`);
        }
        
        removerImagemSidebar();
      } catch (error) {
        const container = document.getElementById('sidebar-chat-messages');
        container.removeChild(container.lastChild);
        adicionarMensagemSidebar('ai', `âŒ Erro de conexÃ£o: ${error.message}`);
      }
      
      sendBtn.disabled = false;
    }

    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'k') {
        e.preventDefault();
        toggleChat();
      }
    });

    function mostrarDeploy() {
      const modal = document.createElement('div');
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10001; padding: 20px;';
      
      modal.innerHTML = `
        <div style="background: white; border-radius: 16px; padding: 40px; max-width: 600px; max-height: 90vh; overflow-y: auto;">
          <h2 style="color: #10b981; margin-bottom: 20px; font-size: 28px;">ğŸš€ Deploy para ProduÃ§Ã£o</h2>
          
          <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 10px 0;">âœ… Sistema Configurado!</h3>
            <p style="margin: 0; font-size: 14px;">Tudo pronto para publicar em produÃ§Ã£o</p>
          </div>

          <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
            <h3 style="color: #333; margin: 0 0 15px 0;">ğŸ“‹ Passos para Deploy:</h3>
            <ol style="margin: 0; padding-left: 20px; line-height: 2; color: #666;">
              <li><strong>Clique em "Publish"</strong> no topo do Replit</li>
              <li><strong>Confirme</strong> as configuraÃ§Ãµes (jÃ¡ estÃ£o corretas)</li>
              <li><strong>Aguarde</strong> 1-2 minutos para deploy completar</li>
              <li><strong>Acesse:</strong> https://radio-business-brasil.replit.app/</li>
            </ol>
          </div>

          <div style="background: #eff6ff; padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #667eea;">
            <h3 style="color: #667eea; margin: 0 0 10px 0;">ğŸŒ URL de ProduÃ§Ã£o</h3>
            <code style="background: white; padding: 10px; border-radius: 8px; display: block; color: #333; font-size: 14px; word-break: break-all;">https://radio-business-brasil.replit.app/dashboard.html</code>
          </div>

          <div style="background: #fef3c7; padding: 15px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #f59e0b;">
            <strong style="color: #92400e;">âš ï¸ Importante:</strong>
            <p style="margin: 5px 0 0 0; color: #92400e; font-size: 14px;">Sistema configurado como VM (Always On) - Roda 24/7</p>
          </div>

          <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button onclick="this.closest('div').parentElement.remove()" style="padding: 12px 24px; background: #e5e7eb; color: #333; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Fechar</button>
            <a href="https://radio-business-brasil.replit.app/dashboard.html" target="_blank" style="padding: 12px 24px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 8px; font-weight: bold; text-decoration: none; display: inline-block;">ğŸŒ Abrir ProduÃ§Ã£o</a>
          </div>
        </div>
      `;
      
      modal.onclick = (e) => {
        if (e.target === modal) modal.remove();
      };
      
      document.body.appendChild(modal);
    }

    function modalDeployPagina(pathName) {
      const modal = document.createElement('div');
      modal.id = 'modal-deploy-pagina';
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10001; padding: 20px;';
      
      modal.innerHTML = `
        <div style="background: white; border-radius: 16px; padding: 40px; max-width: 650px; max-height: 90vh; overflow-y: auto;">
          <h2 style="color: #10b981; margin-bottom: 20px; font-size: 28px;">ğŸš€ Deploy de PÃ¡gina</h2>
          
          <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 10px 0;">ğŸ“„ PÃ¡gina Selecionada:</h3>
            <code style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; display: block; color: white; font-size: 16px; font-weight: bold;">${pathName}</code>
            <a href="/pages/${pathName}" target="_blank" style="display: inline-block; margin-top: 10px; padding: 8px 16px; background: white; color: #667eea; border-radius: 6px; text-decoration: none; font-weight: bold; font-size: 14px;">ğŸ‘ï¸ Visualizar PÃ¡gina Antes de Deployar</a>
          </div>

          <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
            <h3 style="color: #333; margin: 0 0 15px 0;">âš™ï¸ Configurar Deploy no GitHub:</h3>
            
            <label style="display: block; margin-bottom: 15px;">
              <strong style="color: #666; display: block; margin-bottom: 5px;">ğŸ“¦ RepositÃ³rio (usuario/repo):</strong>
              <input type="text" id="deploy-repo" placeholder="Ex: seu-usuario/meu-site" 
                     style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;" />
            </label>

            <label style="display: block; margin-bottom: 15px;">
              <strong style="color: #666; display: block; margin-bottom: 5px;">ğŸŒ¿ Branch:</strong>
              <input type="text" id="deploy-branch" value="main" 
                     style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;" />
            </label>

            <label style="display: block; margin-bottom: 15px;">
              <strong style="color: #666; display: block; margin-bottom: 5px;">ğŸ”— Endpoint Principal (onde a pÃ¡gina serÃ¡ acessÃ­vel):</strong>
              <input type="text" id="deploy-endpoint" placeholder="Ex: replit.rbb/licitacao ou vercel.app/servicos" 
                     style="width: 100%; padding: 10px; border: 2px solid #10b981; border-radius: 8px; font-size: 14px; font-weight: 500;" />
              <small style="color: #666; font-size: 12px; display: block; margin-top: 5px; line-height: 1.4;">
                ğŸ’¡ <strong>Digite a URL completa onde a pÃ¡gina vai ficar:</strong><br>
                â€¢ replit.rbb/licitacao<br>
                â€¢ vercel.rbb/propostas<br>
                â€¢ seu-dominio.com/pagina
              </small>
            </label>

            <label style="display: block; margin-bottom: 15px;">
              <strong style="color: #666; display: block; margin-bottom: 5px;">ğŸ“‚ Pasta Destino (opcional):</strong>
              <input type="text" id="deploy-pasta" placeholder="Ex: website (deixe vazio para raiz)" 
                     style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;" />
            </label>

            <label style="display: block; margin-bottom: 0;">
              <strong style="color: #666; display: block; margin-bottom: 5px;">ğŸ“ Mensagem do Commit:</strong>
              <input type="text" id="deploy-mensagem" value="Deploy: ${pathName}" 
                     style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;" />
            </label>
          </div>

          <div style="background: #fef3c7; padding: 15px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #f59e0b;">
            <strong style="color: #92400e;">âš ï¸ AtenÃ§Ã£o:</strong>
            <p style="margin: 5px 0 0 0; color: #92400e; font-size: 14px;">
              Confira se a pÃ¡gina estÃ¡ correta antes de fazer deploy!<br>
              Esta aÃ§Ã£o enviarÃ¡ a pÃ¡gina <strong>${pathName}</strong> para o GitHub.
            </p>
          </div>

          <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button onclick="document.getElementById('modal-deploy-pagina').remove()" 
                    style="padding: 12px 24px; background: #e5e7eb; color: #333; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
              Cancelar
            </button>
            <button onclick="executarDeployPagina('${pathName}')" 
                    style="padding: 12px 24px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;"
                    id="btn-confirmar-deploy">
              ğŸš€ Confirmar Deploy
            </button>
          </div>
        </div>
      `;
      
      modal.onclick = (e) => {
        if (e.target === modal) modal.remove();
      };
      
      document.body.appendChild(modal);
    }

    async function executarDeployPagina(pathName) {
      const repo = document.getElementById('deploy-repo').value.trim();
      const branch = document.getElementById('deploy-branch').value.trim() || 'main';
      const endpoint = document.getElementById('deploy-endpoint').value.trim();
      const pasta = document.getElementById('deploy-pasta').value.trim();
      const mensagem = document.getElementById('deploy-mensagem').value.trim() || `Deploy: ${pathName}`;

      if (!repo) {
        alert('âŒ Por favor, informe o repositÃ³rio (usuario/repo)');
        return;
      }

      const btn = document.getElementById('btn-confirmar-deploy');
      btn.disabled = true;
      btn.textContent = 'â³ Enviando...';

      try {
        const response = await fetch(`${API_BASE_URL}/api/github/push`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            pasta_local: `paginas_geradas/${pathName}`,
            repositorio: repo,
            branch: branch,
            mensagem_commit: mensagem,
            pasta_destino: pasta || '',
            endpoint_principal: endpoint || ''
          })
        });

        const data = await response.json();

        if (data.success) {
          document.getElementById('modal-deploy-pagina').remove();
          const endpointMsg = endpoint ? `\n\nğŸ”— AcessÃ­vel em: ${endpoint.startsWith('http') ? endpoint : 'https://' + endpoint}` : '';
          mostrarNotificacao(`âœ… Deploy concluÃ­do!${endpointMsg}`, 'success');
          adicionarLog('GitHub', `Deploy de ${pathName} para ${repo}${endpoint ? ' â†’ Endpoint: ' + endpoint : ''}`);
        } else {
          btn.disabled = false;
          btn.textContent = 'ğŸš€ Confirmar Deploy';
          alert(`âŒ Erro no deploy: ${data.error || 'Erro desconhecido'}`);
        }
      } catch (error) {
        btn.disabled = false;
        btn.textContent = 'ğŸš€ Confirmar Deploy';
        alert(`âŒ Erro de conexÃ£o: ${error.message}`);
      }
    }

    function mostrarNotificacao(mensagem, tipo = 'info') {
      const notif = document.createElement('div');
      notif.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 20px 30px;
        background: ${tipo === 'success' ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'};
        color: white;
        border-radius: 12px;
        font-weight: bold;
        z-index: 10002;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        animation: slideIn 0.3s ease-out;
      `;
      notif.textContent = mensagem;
      
      document.body.appendChild(notif);
      
      setTimeout(() => {
        notif.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => notif.remove(), 300);
      }, 3000);
    }

    async function carregarPaginas() {
      const { data, error } = await supabase
        .from('paginas_geradas')
        .select('*')
        .order('created_at', { ascending: false })
        .limit(10);

      if (error) {
        document.getElementById('paginas-lista').innerHTML = `
          <div class="empty-state">
            <h3>No pages yet</h3>
            <p>Click "ğŸ“„ Test Page" or ask the AI to create pages!</p>
          </div>
        `;
        return;
      }

      if (!data || data.length === 0) {
        document.getElementById('paginas-lista').innerHTML = `
          <div class="empty-state">
            <h3>No pages yet</h3>
            <p>Click "ğŸ“„ Test Page" or ask the AI to create pages!</p>
          </div>
        `;
        return;
      }

      const baseUrl = window.location.origin;
      
      const html = `
        <div style="display: grid; gap: 15px;">
          ${data.map(p => `
            <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div>
                  <strong style="color: white; font-size: 16px;">ğŸ“„ ${p.path_name}</strong>
                  <p style="color: rgba(255,255,255,0.8); margin: 5px 0 0 0; font-size: 13px;">
                    Created ${new Date(p.created_at).toLocaleString()}
                  </p>
                </div>
                <a href="/pages/${p.path_name}" target="_blank" 
                   style="padding: 10px 20px; background: white; color: #667eea; border-radius: 8px; text-decoration: none; font-weight: bold; display: inline-block;"
                   data-testid="link-page-${p.path_name}">
                  ğŸ‘ï¸ Visualizar
                </a>
              </div>
              <div style="display: flex; gap: 10px;">
                <button onclick="copiarLink('${baseUrl}/pages/${p.path_name}')" 
                        style="flex: 1; padding: 10px 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 8px; font-weight: bold; cursor: pointer;"
                        data-testid="button-copy-${p.path_name}">
                  ğŸ“‹ Copiar Link
                </button>
                <button onclick="modalDeployPagina('${p.path_name}')" 
                        style="flex: 1; padding: 10px 20px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: transform 0.2s;"
                        onmouseover="this.style.transform='scale(1.05)'" 
                        onmouseout="this.style.transform='scale(1)'"
                        data-testid="button-deploy-${p.path_name}">
                  ğŸš€ Deploy
                </button>
                <button onclick="confirmarDeletarPagina('${p.path_name}', ${p.id})" 
                        style="padding: 10px 20px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: transform 0.2s;"
                        onmouseover="this.style.transform='scale(1.05)'" 
                        onmouseout="this.style.transform='scale(1)'"
                        data-testid="button-delete-${p.path_name}">
                  ğŸ—‘ï¸ Deletar
                </button>
              </div>
            </div>
          `).join('')}
        </div>
      `;
      
      document.getElementById('paginas-lista').innerHTML = html;
    }

    function copiarLink(url) {
      navigator.clipboard.writeText(url).then(() => {
        alert('âœ… Link copiado!\n\n' + url);
      });
    }

    function confirmarDeletarPagina(pathName, id) {
      const modal = document.createElement('div');
      modal.id = 'modal-deletar-pagina';
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10001; padding: 20px;';
      
      modal.innerHTML = `
        <div style="background: white; border-radius: 16px; padding: 40px; max-width: 550px;">
          <h2 style="color: #ef4444; margin-bottom: 20px; font-size: 28px;">ğŸ—‘ï¸ Deletar PÃ¡gina</h2>
          
          <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 10px 0;">âš ï¸ PÃ¡gina a ser deletada:</h3>
            <code style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; display: block; color: white; font-size: 16px; font-weight: bold;">${pathName}</code>
          </div>

          <div style="background: #fef3c7; padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #f59e0b;">
            <strong style="color: #92400e;">âš ï¸ ATENÃ‡ÃƒO:</strong>
            <p style="margin: 10px 0 0 0; color: #92400e; font-size: 14px; line-height: 1.6;">
              â€¢ Esta aÃ§Ã£o deleta a pÃ¡gina <strong>LOCALMENTE</strong> (banco de dados)<br>
              â€¢ Se vocÃª fez deploy no GitHub, a pÃ¡gina continuarÃ¡ lÃ¡<br>
              â€¢ Para remover do GitHub, delete manualmente no repositÃ³rio<br>
              â€¢ <strong>Esta aÃ§Ã£o nÃ£o pode ser desfeita!</strong>
            </p>
          </div>

          <div style="background: #dcfce7; padding: 15px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #10b981;">
            <strong style="color: #166534;">ğŸ’¡ Dica:</strong>
            <p style="margin: 5px 0 0 0; color: #166534; font-size: 14px;">
              ApÃ³s deletar, vocÃª pode criar uma nova versÃ£o melhorada e fazer deploy novamente!
            </p>
          </div>

          <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button onclick="document.getElementById('modal-deletar-pagina').remove()" 
                    style="padding: 12px 24px; background: #e5e7eb; color: #333; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
              Cancelar
            </button>
            <button onclick="executarDeletarPagina(${id}, '${pathName}')" 
                    style="padding: 12px 24px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;"
                    id="btn-confirmar-deletar">
              ğŸ—‘ï¸ Confirmar ExclusÃ£o
            </button>
          </div>
        </div>
      `;
      
      modal.onclick = (e) => {
        if (e.target === modal) modal.remove();
      };
      
      document.body.appendChild(modal);
    }

    async function executarDeletarPagina(id, pathName) {
      const btn = document.getElementById('btn-confirmar-deletar');
      btn.disabled = true;
      btn.textContent = 'â³ Deletando...';

      try {
        const { error } = await supabase
          .from('paginas_geradas')
          .delete()
          .eq('id', id);

        if (error) throw error;

        document.getElementById('modal-deletar-pagina').remove();
        mostrarNotificacao('âœ… PÃ¡gina deletada com sucesso!', 'success');
        adicionarLog('Sistema', `PÃ¡gina ${pathName} deletada localmente`);
        carregarPaginas();
      } catch (error) {
        btn.disabled = false;
        btn.textContent = 'ğŸ—‘ï¸ Confirmar ExclusÃ£o';
        alert(`âŒ Erro ao deletar: ${error.message}`);
      }
    }

    async function carregarTarefas() {
      const { data, error } = await supabase
        .from('agentes_tarefas')
        .select('*')
        .in('status', ['fila', 'processando'])
        .order('created_at', { ascending: false })
        .limit(1);

      if (error) {
        document.getElementById('tarefas-lista').innerHTML = '<p style="color: #ef4444; text-align: center;">Error: ' + error.message + '</p>';
        return;
      }

      if (!data || data.length === 0) {
        document.getElementById('tarefas-lista').innerHTML = '<div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; text-align: center; color: white;"><strong>âœ… Nenhuma tarefa em execuÃ§Ã£o</strong><p style="margin: 10px 0 0 0; opacity: 0.9;">Aguardando prÃ³xima tarefa...</p></div>';
        return;
      }

      const t = data[0];
      const statusColors = {
        'fila': '#3b82f6',
        'processando': '#f59e0b',
        'concluido': '#10b981',
        'erro': '#ef4444'
      };
      const statusColor = statusColors[t.status] || '#666';

      let html = '<div style="background: white; border-radius: 12px; padding: 25px; border-left: 5px solid ' + statusColor + '; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">';
      
      html += '<div style="margin-bottom: 20px;">';
      html += '<strong style="color: ' + statusColor + '; font-size: 20px;">âš¡ TAREFA ATUAL - #' + t.id + '</strong>';
      html += '<p style="color: #666; margin: 8px 0 0 0; font-size: 14px;">ğŸ“… ' + new Date(t.created_at).toLocaleString() + '</p>';
      html += '</div>';

      html += '<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">';
      html += '<div style="background: #f0f9ff; padding: 15px; border-radius: 8px; border-left: 3px solid #3b82f6;">';
      html += '<strong style="color: #666; font-size: 12px; display: block; margin-bottom: 5px;">ğŸ¤– AGENTE</strong>';
      html += '<span style="color: #333; font-family: monospace; font-weight: 600; font-size: 14px;">' + t.agente + '</span>';
      html += '</div>';
      
      html += '<div style="background: #fef3c7; padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b;">';
      html += '<strong style="color: #666; font-size: 12px; display: block; margin-bottom: 5px;">ğŸ“Œ TIPO</strong>';
      html += '<span style="color: #333; font-family: monospace; font-weight: 600; font-size: 14px;">' + t.tipo + '</span>';
      html += '</div>';

      html += '<div style="background: ' + (t.status === 'processando' ? '#fef3c7' : '#eff6ff') + '; padding: 15px; border-radius: 8px; border-left: 3px solid ' + statusColor + ';">';
      html += '<strong style="color: #666; font-size: 12px; display: block; margin-bottom: 5px;">ğŸ”„ STATUS</strong>';
      html += '<span style="color: ' + statusColor + '; font-family: monospace; font-weight: bold; font-size: 14px; text-transform: uppercase;">' + t.status + '</span>';
      html += '</div>';
      html += '</div>';

      if (t.payload) {
        try {
          const payload = typeof t.payload === 'string' ? JSON.parse(t.payload) : t.payload;
          if (payload.prompt || payload.titulo || payload.descricao) {
            html += '<div style="background: #f9fafb; padding: 15px; border-radius: 8px; border-left: 3px solid #9ca3af;">';
            html += '<strong style="color: #666; font-size: 12px; display: block; margin-bottom: 8px;">ğŸ“ DETALHES</strong>';
            const info = payload.prompt || payload.titulo || payload.descricao || '';
            const truncated = info.length > 150 ? info.substring(0, 150) + '...' : info;
            html += '<p style="color: #333; margin: 0; font-size: 13px; line-height: 1.6;">' + truncated + '</p>';
            html += '</div>';
          }
        } catch (e) {}
      }

      html += '</div>';
      document.getElementById('tarefas-lista').innerHTML = html;
    }

    async function carregarLogs() {
      const { data, error } = await supabase
        .from('logs_agentes')
        .select('*')
        .order('created_at', { ascending: false })
        .limit(30);

      if (error) {
        document.getElementById('logs-lista').innerHTML = `
          <div class="empty-state">
            <h3>Logs not available</h3>
            <p>Log system is being configured.</p>
          </div>
        `;
        return;
      }

      if (!data || data.length === 0) {
        document.getElementById('logs-lista').innerHTML = `
          <div class="empty-state">
            <h3>No logs yet</h3>
            <p>Logs will appear here as tasks are processed.</p>
          </div>
        `;
        return;
      }

      const html = data.map(log => `
        <div class="log-entry ${log.level || 'info'}">
          <strong>[${(log.level || 'INFO').toUpperCase()}]</strong> ${log.message || 'No message'}
          <br>
          <small>${new Date(log.created_at).toLocaleString()} - ${log.agente || 'System'}</small>
        </div>
      `).join('');
      
      document.getElementById('logs-lista').innerHTML = html;
    }

    function refreshAll() {
      atualizarDashboard();
      carregarTarefas();
      carregarPaginas();
      carregarLogs();
      carregarErros();
    }

    async function carregarErros() {
      // Verifica se hÃ¡ tarefa de correÃ§Ã£o em andamento
      const { data: todasTarefas } = await supabase
        .from('agentes_tarefas')
        .select('*')
        .eq('agente', 'RBB_AgenteArquiteto')
        .in('status', ['fila', 'processando'])
        .order('created_at', { ascending: false })
        .limit(10);

      if (todasTarefas && todasTarefas.length > 0) {
        for (const tarefa of todasTarefas) {
          try {
            const payload = typeof tarefa.payload === 'string' ? JSON.parse(tarefa.payload) : tarefa.payload;
            if (payload && payload.corrigindo_tarefa === true) {
              const statusIcon = tarefa.status === 'processando' ? 'ğŸ”§' : 'â³';
              const statusText = tarefa.status === 'processando' ? 'CORRIGINDO AGORA' : 'NA FILA PARA CORRIGIR';
              
              document.getElementById('erros-lista').innerHTML = '<div style="background: linear-gradient(135deg, #f59e0b 0%, #ea580c 100%); border-radius: 12px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); animation: pulse 2s infinite;"><div style="text-align: center;"><strong style="color: white; font-size: 22px; display: block; margin-bottom: 10px;">' + statusIcon + ' ARQUITETO IA TRABALHANDO</strong><p style="color: rgba(255,255,255,0.95); font-size: 16px; margin: 0; font-weight: 600;">' + statusText + '</p><p style="color: rgba(255,255,255,0.85); font-size: 14px; margin: 15px 0 0 0;">Analisando erro e gerando correÃ§Ã£o...</p></div></div>';
              return;
            }
          } catch (e) {
            // Ignora erros de parse
          }
        }
      }

      const { data, error } = await supabase
        .from('agentes_tarefas')
        .select('*')
        .eq('status', 'erro')
        .order('created_at', { ascending: false })
        .limit(1);

      if (error || !data || data.length === 0) {
        document.getElementById('erros-lista').innerHTML = '<div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; text-align: center; color: white;"><strong>âœ… Nenhum erro no momento</strong><p style="margin: 10px 0 0 0; opacity: 0.9;">Aguardando prÃ³ximo evento...</p></div>';
        return;
      }

      const erro = data[0];
      let errorInfo = {
        message: 'Erro desconhecido',
        stack: '',
        agente: erro.agente,
        tipo: erro.tipo
      };
      
      try {
        const res = JSON.parse(erro.resultado || '{}');
        if (res.error) {
          errorInfo.message = res.error.message || 'Erro desconhecido';
          errorInfo.stack = res.error.stack || '';
        }
      } catch (e) {
        errorInfo.message = erro.resultado || 'Erro ao processar resultado';
      }

      let html = '<div style="background: white; border-radius: 12px; padding: 25px; border-left: 5px solid #ef4444; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">';
      
      html += '<div style="margin-bottom: 20px;">';
      html += '<strong style="color: #ef4444; font-size: 20px;">âš ï¸ ERRO ATUAL - Tarefa #' + erro.id + '</strong>';
      html += '<p style="color: #666; margin: 8px 0 0 0; font-size: 14px;">ğŸ“… ' + new Date(erro.created_at).toLocaleString() + '</p>';
      html += '<p style="color: #667eea; margin: 12px 0 0 0; font-size: 14px; font-weight: 600;">ğŸ’¬ Use o chat de execuÃ§Ã£o acima para pedir correÃ§Ã£o ou ajuste</p>';
      html += '</div>';

      html += '<div style="background: #fef3c7; padding: 18px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #f59e0b;">';
      html += '<strong style="color: #92400e; display: block; margin-bottom: 10px; font-size: 15px;">âŒ ERRO DURANTE EXECUÃ‡ÃƒO:</strong>';
      html += '<p style="color: #92400e; margin: 0; font-size: 15px; line-height: 1.7; font-family: monospace; word-break: break-word; font-weight: 500;">' + errorInfo.message + '</p>';
      html += '</div>';

      if (errorInfo.stack) {
        html += '<details style="margin-bottom: 15px;">';
        html += '<summary style="cursor: pointer; color: #666; font-weight: bold; padding: 10px; background: #f3f4f6; border-radius: 8px; font-size: 14px;">ğŸ“‹ Ver Stack Trace Completo</summary>';
        html += '<pre style="background: #1e293b; color: #22d3ee; padding: 18px; border-radius: 8px; overflow-x: auto; font-size: 12px; margin: 12px 0 0 0; line-height: 1.5;">' + errorInfo.stack + '</pre>';
        html += '</details>';
      }

      html += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 14px; padding: 15px; background: #f9fafb; border-radius: 8px;">';
      html += '<div><strong style="color: #666;">ğŸ¤– Agente:</strong> <span style="color: #333; font-family: monospace; font-weight: 600;">' + errorInfo.agente + '</span></div>';
      html += '<div><strong style="color: #666;">ğŸ“Œ Tipo:</strong> <span style="color: #333; font-family: monospace; font-weight: 600;">' + errorInfo.tipo + '</span></div>';
      html += '</div>';

      html += '</div>';

      document.getElementById('erros-lista').innerHTML = html;
    }

    async function corrigirErro(tarefaId) {
      const prompt = 'A tarefa #' + tarefaId + ' falhou. Analise o erro no banco de dados, corrija e execute novamente com sucesso.';
      
      if (!confirm('ğŸ”§ Enviar correÃ§Ã£o automÃ¡tica para o Arquiteto IA?\n\nEle vai analisar o erro da tarefa #' + tarefaId + ' e corrigir automaticamente.')) {
        return;
      }

      try {
        // Marca a tarefa original como "resolvido" para sair da lista de erros
        const { error: updateError } = await supabase
          .from('agentes_tarefas')
          .update({ status: 'resolvido' })
          .eq('id', tarefaId);

        if (updateError) throw updateError;

        // Cria nova tarefa para o Arquiteto corrigir
        const { error: insertError } = await supabase
          .from('agentes_tarefas')
          .insert({
            agente: 'RBB_AgenteArquiteto',
            tipo: 'tarefa_arquiteto',
            payload: { prompt: prompt, corrigindo_tarefa: true, tarefa_erro_id: tarefaId },
            status: 'fila',
            prioridade: 10
          });

        if (insertError) throw insertError;

        // Mostra feedback imediato
        document.getElementById('erros-lista').innerHTML = '<div style="background: linear-gradient(135deg, #f59e0b 0%, #ea580c 100%); border-radius: 12px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); animation: pulse 2s infinite;"><div style="text-align: center;"><strong style="color: white; font-size: 22px; display: block; margin-bottom: 10px;">â³ ARQUITETO IA TRABALHANDO</strong><p style="color: rgba(255,255,255,0.95); font-size: 16px; margin: 0; font-weight: 600;">NA FILA PARA CORRIGIR</p><p style="color: rgba(255,255,255,0.85); font-size: 14px; margin: 15px 0 0 0;">Aguardando processamento...</p></div></div>';
        
        // Atualiza a cada 3 segundos para mostrar progresso em tempo real
        setTimeout(() => refreshAll(), 3000);
      } catch (err) {
        alert('âŒ Erro: ' + err.message);
      }
    }

    function inicializarDashboard() {
      refreshAll();
      carregarModeloAtual(); // Carrega modelo GPT atual
      
      // Mensagem de boas-vindas
      adicionarMensagemChat('ai', 'ğŸ‘‹ OlÃ¡! Sou o Arquiteto IA.\n\nPosso fazer qualquer coisa para vocÃª:\n\nâ€¢ Criar pÃ¡ginas web\nâ€¢ Executar cÃ³digo Python/Node/Java\nâ€¢ Enviar emails\nâ€¢ Analisar dados\nâ€¢ Automatizar tarefas\n\nO que vocÃª quer que eu faÃ§a?');
      
      // FORÃ‡A botÃ£o verde funcionar
      const btn = document.getElementById('btn-enviar');
      if (btn) {
        btn.onclick = function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('ğŸŸ¢ BOTÃƒO VERDE CLICADO!');
          enviarMensagem();
          return false;
        };
        console.log('âœ… BotÃ£o verde configurado');
      }
      
      // Auto-refresh every 5 seconds
      setInterval(refreshAll, 5000);

      // Realtime subscriptions
      supabase
        .channel('tarefas_channel')
        .on('postgres_changes', { 
          event: '*', 
          schema: 'public', 
          table: 'agentes_tarefas' 
        }, () => {
          refreshAll();
        })
        .subscribe();
    }

    // Enter key login
    document.getElementById('password-input').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') login();
    });

    // Enter key para enviar mensagem
    document.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && e.target.id === 'chat-input') {
        enviarMensagem();
      }
    });

    // ===== GOOGLE WORKSPACE INTEGRATIONS =====
    
    async function conectarIntegracao(service) {
      try {
        const response = await fetch(`${API_BASE_URL}/api/google/connect`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ service })
        });

        const result = await response.json();

        if (result.success) {
          let instructionsText = result.instructions.join('\n');
          alert(`ğŸ”— Conectar ${service.toUpperCase()}\n\n${result.message}\n\nğŸ“‹ InstruÃ§Ãµes:\n${instructionsText}\n\nğŸ’¡ ApÃ³s conectar, volte aqui e clique em "Testar" para verificar!`);
          
          // Mostrar seÃ§Ã£o de teste
          document.getElementById('integration-test-section').style.display = 'block';
        } else {
          alert(`âŒ Erro: ${result.error}`);
        }
      } catch (error) {
        alert(`âŒ Erro ao conectar: ${error.message}`);
      }
    }

    async function testarIntegracao() {
      const select = document.getElementById('test-integration-select');
      const service = select.value;

      if (!service) {
        alert('âš ï¸ Selecione uma integraÃ§Ã£o para testar!');
        return;
      }

      const resultDiv = document.getElementById('test-result');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<div style="color: #f59e0b;">â³ Testando conexÃ£o...</div>';

      try {
        const response = await fetch(`${API_BASE_URL}/api/google/test`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ service })
        });

        const result = await response.json();

        if (result.success) {
          resultDiv.style.background = '#f0fdf4';
          resultDiv.style.border = '2px solid #10b981';
          resultDiv.innerHTML = `
            <div style="color: #065f46;">
              <strong>âœ… ${service.toUpperCase()} - Teste bem-sucedido!</strong>
              <div style="margin-top: 10px;">
                <strong>AÃ§Ã£o:</strong> ${result.test.action}
              </div>
              <div style="margin-top: 5px;">
                <strong>Resultado:</strong> ${result.test.result}
              </div>
              <div style="margin-top: 5px; color: #059669;">
                ${result.test.details}
              </div>
              <div style="margin-top: 10px; font-size: 11px; opacity: 0.7;">
                Testado em: ${new Date(result.timestamp).toLocaleString()}
              </div>
            </div>
          `;

          // Atualizar badge de status
          const card = document.querySelector(`.integration-card[data-integration="${service}"]`);
          if (card) {
            const badge = card.querySelector('.status-badge');
            if (badge) {
              badge.textContent = 'Conectado';
              badge.style.background = '#d1fae5';
              badge.style.color = '#065f46';
            }
            
            const btn = card.querySelector('.btn-connect');
            if (btn) {
              btn.textContent = 'âœ… Conectado';
              btn.style.background = '#10b981';
              btn.disabled = true;
              btn.style.cursor = 'not-allowed';
            }
          }

        } else {
          resultDiv.style.background = '#fef2f2';
          resultDiv.style.border = '2px solid #ef4444';
          
          if (result.needsConnection) {
            resultDiv.innerHTML = `
              <div style="color: #991b1b;">
                <strong>âš ï¸ ${service.toUpperCase()} - NÃ£o conectado</strong>
                <div style="margin-top: 10px;">
                  ${result.error}
                </div>
                <div style="margin-top: 10px;">
                  <button onclick="conectarIntegracao('${service}')" style="padding: 8px 16px; background: #4285F4; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                    ğŸ”Œ Conectar Agora
                  </button>
                </div>
              </div>
            `;
          } else {
            resultDiv.innerHTML = `
              <div style="color: #991b1b;">
                <strong>âŒ Erro no teste</strong>
                <div style="margin-top: 10px;">${result.error}</div>
              </div>
            `;
          }
        }

      } catch (error) {
        resultDiv.style.background = '#fef2f2';
        resultDiv.style.border = '2px solid #ef4444';
        resultDiv.innerHTML = `
          <div style="color: #991b1b;">
            <strong>âŒ Erro ao testar</strong>
            <div style="margin-top: 10px;">${error.message}</div>
          </div>
        `;
      }
    }

    async function verificarStatusIntegracoes() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/google/status`);
        const result = await response.json();

        if (result.success) {
          // Atualizar status de cada integraÃ§Ã£o
          for (const [service, data] of Object.entries(result.status)) {
            const card = document.querySelector(`.integration-card[data-integration="${service}"]`);
            if (card) {
              const badge = card.querySelector('.status-badge');
              const btn = card.querySelector('.btn-connect');
              
              if (data.connected) {
                if (badge) {
                  badge.textContent = 'Conectado';
                  badge.style.background = '#d1fae5';
                  badge.style.color = '#065f46';
                }
                if (btn) {
                  btn.textContent = 'âœ… Conectado';
                  btn.style.background = '#10b981';
                }
              }
            }
          }
        }
      } catch (error) {
        console.error('Erro ao verificar status das integraÃ§Ãµes:', error);
      }
    }

  </script>
</body>
</html>
